<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timee å–¶æ¥­æ”¯æ´çµ±åˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- General Styles --- */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }

        /* --- Sidebar Styles --- */
        .sidebar {
            width: 240px; /* Reduced width */
            background-color: #1e293b; /* slate-800 */
            color: #94a3b8; /* slate-400 */
            transition: width 0.3s ease;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: #cbd5e1; /* slate-300 */
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        .sidebar-link:hover {
            background-color: #334155; /* slate-700 */
            color: #ffffff;
        }
        .sidebar-link.active {
            background-color: #0f172a; /* slate-900 */
            color: #ffffff;
            font-weight: 600;
            border-left-color: #38bdf8; /* sky-400 */
        }
        .sidebar-link svg {
            margin-right: 1rem;
        }
        .main-content > .page {
            display: none;
        }
        .main-content > .page.active {
            display: block;
        }

        /* --- Proposal Generator Styles --- */
        #page-generator {
             background-color: #f8fafc; /* slate-50 */
        }
        .accent-color { color: #0284c7; } /* sky-600 */
        .accent-bg { background-color: #0284c7; } /* sky-600 */
        
        .copy-btn {
            background-color: #e2e8f0; /* slate-200 */
            border: none;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            line-height: 1;
            color: #475569; /* slate-600 */
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
        }
        .copy-btn:hover { background-color: #cbd5e1; } /* slate-300 */
        .copied-feedback { background-color: #10B981 !important; color: white !important; }
        .section-content {
            white-space: pre-wrap;
            color: #475569; /* slate-600 */
            line-height: 1.7;
            padding-left: 0.25rem;
        }
        .section-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b; /* slate-800 */
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #64748b; /* slate-500 */
            transition: all 0.2s;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        .tab:hover { color: #1e293b; } /* slate-800 */
        .tab.active {
            color: #0284c7; /* sky-600 */
            border-bottom-color: #0284c7; /* sky-600 */
            font-weight: 600;
        }
        .tab-panel.hidden { display: none; }
        .highlight-point, .highlight-condition {
            background-color: #ecfeff; /* cyan-50 */
            color: #0891b2; /* cyan-600 */
            font-weight: 600;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }
        .explanation-box {
            background-color: #f1f5f9; /* slate-100 */
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .explanation-box b { font-weight: 600; }
        .explanation-problem b { color: #be123c; }
        .explanation-interpretation b { color: #1d4ed8; }
        .explanation-solution b { color: #059669; }

        /* --- Talk Script Helper Styles --- */
        #page-script {
             background-color: #f8fafc; /* slate-50 */
        }
        .prose strong { font-weight: 600; }
        .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .loader { border: 4px solid #f1f5f9; border-top: 4px solid #38bdf8; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg);} }
        input:disabled, select:disabled { background-color: #e2e8f0; cursor: not-allowed; }

    </style>
</head>
<body class="bg-slate-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="sidebar flex-shrink-0 p-4">
            <div class="flex items-center mb-10 px-4">
                 <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h1 class="text-xl font-bold text-white ml-3">Sales Tool</h1>
            </div>
            <nav id="sidebar-nav" class="space-y-2">
                <a class="sidebar-link active" data-page="page-generator">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    æ±‚äººåŸç¨¿ ææ¡ˆ
                </a>
                <a class="sidebar-link" data-page="page-script">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content flex-1 overflow-y-auto">
            <!-- Page 1: Proposal Generator -->
            <div id="page-generator" class="page active">
                <div class="container mx-auto max-w-4xl p-8">
                    <header class="text-left mb-8">
                        <h1 class="text-3xl font-bold text-slate-800">
                            æ±‚äººåŸç¨¿ ææ¡ˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼
                        </h1>
                        <p class="mt-2 text-md text-slate-500">ãŠå®¢æ§˜ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ãŸæ±‚äººåŸç¨¿ã‚’ãã®å ´ã§ææ¡ˆã—ã¾ã™ã€‚</p>
                    </header>
                    <div class="bg-white p-6 rounded-lg border border-slate-200 mb-8">
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label for="industry" class="block text-sm font-medium text-slate-700 mb-2">1. æ¥­ç¨®ã‚’é¸æŠ</label>
                                <select id="industry" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                                    <option value="ã‚³ãƒ³ãƒ“ãƒ‹">ã‚³ãƒ³ãƒ“ãƒ‹</option>
                                    <option value="é£²é£Ÿåº—">é£²é£Ÿåº—</option>
                                    <option value="å°å£²ãƒ»è²©å£²">å°å£²ãƒ»è²©å£²</option>
                                    <option value="è»½ä½œæ¥­ãƒ»ç‰©æµ">è»½ä½œæ¥­ãƒ»ç‰©æµ</option>
                                    <option value="ã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯">ã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯</option>
                                    <option value="ã‚¤ãƒ™ãƒ³ãƒˆ">ã‚¤ãƒ™ãƒ³ãƒˆ</option>
                                </select>
                            </div>
                            <div>
                                <label for="work-details" class="block text-sm font-medium text-slate-700 mb-2">2. å…·ä½“çš„ãªæ¥­å‹™å†…å®¹<span class="ml-2 font-normal text-slate-500">ï¼ˆä»»æ„ï¼‰</span></label>
                                <input type="text" id="work-details" placeholder="ä¾‹ï¼šãƒ›ãƒ¼ãƒ«ã€ã‚­ãƒƒãƒãƒ³è£œåŠ©ã€å“å‡ºã—ã€æ¸…æƒ" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                            </div>
                            <div>
                                <label for="needs" class="block text-sm font-medium text-slate-700 mb-2">3. ãŠå®¢æ§˜ã®ãƒ‹ãƒ¼ã‚ºãƒ»èª²é¡Œã‚’å…¥åŠ›<span class="ml-2 font-normal text-slate-500">ï¼ˆä»»æ„ï¼‰</span></label>
                                <input type="text" id="needs" placeholder="ä¾‹ï¼šæœªçµŒé¨“, çµŒé¨“è€…ã«æ¥ã¦ã»ã—ã„, å‰å›ãƒãƒƒãƒãƒ³ã‚°ã—ãªã‹ã£ãŸ" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                            </div>
                        </div>
                        <div class="mt-6">
                            <button id="generateBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-12 rounded-md hover:bg-sky-700 transition-all transform hover:scale-[1.02] shadow-sm">
                                ææ¡ˆã‚’ç”Ÿæˆã™ã‚‹
                            </button>
                        </div>
                    </div>
                    <div id="result">
                        <div id="initial-message" class="text-center text-slate-400 py-16 px-6 bg-white rounded-lg border border-slate-200">
                            <svg class="mx-auto h-12 w-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0014 18.442V19.5a.75.75 0 01-1.5 0v-1.059a3.375 3.375 0 00-1.846-3.05l-.548-.547zM12 18a5 5 0 005.3-4.48c.11-.53.19-1.07.19-1.62 0-3.036-2.464-5.5-5.5-5.5S6.5 8.884 6.5 11.9c0 .55.08 1.09.19 1.62A5 5 0 0012 18z" /></svg>
                            <h3 class="mt-4 text-lg font-medium text-slate-700">ã“ã“ã«ææ¡ˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</h3>
                            <p class="mt-1 text-sm text-slate-500">æ¥­ç¨®ãªã©ã‚’å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Talk Script Helper -->
            <div id="page-script" class="page">
                <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                    <header class="text-left mb-8">
                        <h1 class="text-3xl font-bold text-slate-800">ã‚¿ã‚¤ãƒŸãƒ¼æ´»ç”¨ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆæ”¯æ´</h1>
                        <p class="mt-2 text-md text-slate-500">åº—èˆ—ã¸ã®é›»è©±å–¶æ¥­ã‚’AIãŒã‚µãƒãƒ¼ãƒˆã—ã¾ã™</p>
                    </header>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <main class="lg:col-span-2 space-y-8">
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-xl font-bold mb-4 pb-2 border-b border-slate-200 text-slate-800">1. ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã®å…¥åŠ›</h2>
                                <p class="text-sm text-slate-500 mb-4">ãŠå®¢æ§˜ã‹ã‚‰ãƒ’ã‚¢ãƒªãƒ³ã‚°ã—ãŸå†…å®¹ï¼ˆèª²é¡Œã€åˆ©ç”¨ä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹ãªã©ï¼‰ã‚’å…·ä½“çš„ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
                                <textarea id="hearingContent" class="w-full h-40 p-3 border border-slate-300 rounded-md bg-slate-50 focus:ring-2 focus:ring-sky-500 focus:outline-none transition" placeholder="ä¾‹ï¼šé£²é£Ÿåº—ã®åº—é•·ã€‚æœ€è¿‘ã€é€±æœ«ã®ãƒ©ãƒ³ãƒã‚¿ã‚¤ãƒ ã«äººæ‰‹ãŒè¶³ã‚Šãšã€æ—¢å­˜ã‚¹ã‚¿ãƒƒãƒ•ã®æ®‹æ¥­ãŒå¢—ãˆã¦å›°ã£ã¦ã„ã‚‹ã€‚æ±‚äººåºƒå‘Šã‚’å‡ºã—ã¦ã‚‚å¿œå‹ŸãŒæ¥ãªã„ã€‚ã‚·ã‚§ã‚¢ãƒ•ãƒ«ã‚’æ¤œè¨ã—ãŸã“ã¨ãŒã‚ã‚‹ã€‚"></textarea>
                                <button id="generateScript" class="mt-4 w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-md transition-transform transform hover:scale-[1.02] shadow-sm">ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¡ˆã‚’ä½œæˆ</button>
                            </div>
                            <div id="result-container" class="bg-white p-6 rounded-lg border border-slate-200 hidden">
                                <h2 class="text-xl font-bold mb-4 pb-2 border-b border-slate-200 text-slate-800">AIã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ¡ˆ</h2>
                                <div id="loader" class="flex justify-center items-center h-40"><div class="loader"></div></div>
                                <div id="scriptResult" class="prose max-w-none text-slate-600"></div>
                            </div>
                        </main>
                        <aside class="space-y-8">
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">2. å…¨å›½ã®æœ€ä½è³ƒé‡‘ (2024å¹´åº¦)</h2>
                                <p class="text-sm text-slate-500 mb-4">éƒ½é“åºœçœŒã‚’é¸æŠã™ã‚‹ã¨æœ€ä½è³ƒé‡‘ãŒè¡¨ç¤ºã•ã‚Œã€ä¸‹ã®æ™‚çµ¦ã«è‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚</p>
                                <div>
                                    <label for="prefectureSelect" class="block text-sm font-medium text-slate-700">éƒ½é“åºœçœŒ</label>
                                    <select id="prefectureSelect" class="mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50 focus:ring-2 focus:ring-sky-500 focus:outline-none"></select>
                                </div>
                                <div id="minimumWageResult" class="mt-4 p-4 text-center bg-slate-100 rounded-lg"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">3. ã‚¹ã‚¿ãƒƒãƒ• vs ã‚¿ã‚¤ãƒŸãƒ¼ ã‚³ã‚¹ãƒˆæ¯”è¼ƒ</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700">æ—¢å­˜ã‚¹ã‚¿ãƒƒãƒ•ç¨¼åƒç¨®åˆ¥</label>
                                        <div id="staffWorkTypeToggle" class="mt-1 grid grid-cols-2 gap-1 rounded-lg bg-slate-200 p-1">
                                            <button data-type="overtime" class="work-type-btn bg-white text-sky-600 rounded-md py-1.5 px-2 text-sm font-semibold transition">æ®‹æ¥­</button>
                                            <button data-type="regular" class="work-type-btn bg-transparent text-slate-500 rounded-md py-1.5 px-2 text-sm transition">é€šå¸¸</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="currentStaffHourlyWage" class="block text-sm font-medium text-slate-700">æ—¢å­˜ã‚¹ã‚¿ãƒƒãƒ•ã®æ™‚çµ¦ (å††)</label>
                                        <input type="number" id="currentStaffHourlyWage" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="overtimeRate" class="block text-sm font-medium text-slate-700">æ®‹æ¥­å‰²å¢—ç‡ (%)</label>
                                        <input type="number" id="overtimeRate" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50 transition" value="25">
                                    </div>
                                    <hr class="border-slate-200"/>
                                    <div>
                                        <label for="timeeWorkerHourlyWage" class="block text-sm font-medium text-slate-700">ã‚¿ã‚¤ãƒŸãƒ¼ãƒ¯ãƒ¼ã‚«ãƒ¼ã®æ™‚çµ¦ (å††)</label>
                                        <input type="number" id="timeeWorkerHourlyWage" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="timeeWorkerTransportation" class="block text-sm font-medium text-slate-700">ã‚¿ã‚¤ãƒŸãƒ¼ãƒ¯ãƒ¼ã‚«ãƒ¼ã®äº¤é€šè²» (å††)</label>
                                        <input type="number" id="timeeWorkerTransportation" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="0">
                                    </div>
                                    <hr class="border-slate-200"/>
                                    <div>
                                        <label for="workHours" class="block text-sm font-medium text-slate-700">åŠ´åƒæ™‚é–“ (æ™‚é–“)</label>
                                        <input type="number" id="workHours" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="4">
                                    </div>
                                </div>
                                <div id="costComparisonResult" class="mt-6 p-4 bg-slate-100 rounded-lg"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">4. ç«¶åˆã‚µãƒ¼ãƒ“ã‚¹æ–™é‡‘æ¯”è¼ƒ</h2>
                                <p class="text-sm text-slate-500 mb-4">åŒã˜æ¡ä»¶ã§å„ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã—ãŸå ´åˆã®ã‚³ã‚¹ãƒˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚</p>
                                <div class="space-y-4">
                                    <div>
                                        <label for="simHourlyWage" class="block text-sm font-medium text-slate-700">æ™‚çµ¦ (å††)</label>
                                        <input type="number" id="simHourlyWage" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="simWorkHours" class="block text-sm font-medium text-slate-700">åŠ´åƒæ™‚é–“ (æ™‚é–“)</label>
                                        <input type="number" id="simWorkHours" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="4">
                                    </div>
                                    <div>
                                        <label for="simTransportation" class="block text-sm font-medium text-slate-700">äº¤é€šè²» (å††)</label>
                                        <input type="number" id="simTransportation" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="0">
                                    </div>
                                </div>
                                <div id="serviceComparisonResult" class="mt-6 space-y-3"></div>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>

        </div>
    </div>


<script>
    // --- Page Switching Logic ---
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('#sidebar-nav .sidebar-link');
        const pages = document.querySelectorAll('.main-content .page');

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                const targetPageId = link.getAttribute('data-page');
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                pages.forEach(page => {
                    page.classList.toggle('active', page.id === targetPageId);
                });
            });
        });
        initializeProposalGenerator();
        initializeTalkScriptHelper();
    });


    // --- PROPOSAL GENERATOR SCRIPT ---
    function initializeProposalGenerator() {
        const page = document.getElementById('page-generator');
        if (!page) return;
        
        // Data source remains unchanged
        const documentTemplates1 = [{"concept":"ã€æ–‡æ›¸ã€‘ãƒ•ã‚¡ãƒŸãƒ ãƒ¬ã‚¸çµŒé¨“è€…","keywords":["ãƒ•ã‚¡ãƒŸãƒ","ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ","çµŒé¨“è€…","ãƒ¬ã‚¸"],"industry_type":"è²©å£² / ã‚³ãƒ³ãƒ“ãƒ‹ãƒ»ã‚¹ãƒ¼ãƒ‘ãƒ¼","title":"ã€ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆã€‡ã€‡åº—ã€‘ğŸŸ¢ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆã§ã®ãƒ¬ã‚¸çµŒé¨“è€…é™å®šï¼ˆç›´è¿‘3å¹´ä»¥å†…ï¼‰ğŸŸ¢ãƒ¬ã‚¸æ¥­å‹™ã‚¹ã‚¿ãƒƒãƒ•ã®å‹Ÿé›†ï¼","description":"ï¼¼ç›´è¿‘3å¹´ä»¥å†…ã«ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆã§ã®ãƒ¬ã‚¸çµŒé¨“ãŒã‚ã‚‹æ–¹é™å®šï¼ï¼\n\nãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆã§ã®ãƒ¬ã‚¸æ¥­å‹™ã‚¹ã‚¿ãƒƒãƒ•ã‚’å‹Ÿé›†ã—ã¾ã™ï¼\nãƒ¬ã‚¸æ“ä½œã‚’ãƒ¡ã‚¤ãƒ³ã«ãŠä»»ã›ã™ã‚‹ãŸã‚ã€ãŠä¸€äººã§ãƒ¬ã‚¸å¯¾å¿œãŒã§ãã‚‹æ–¹ã‚’å¯¾è±¡ã¨ã—ã¦ã„ã¾ã™ã€‚\n\néƒµé€å¯¾å¿œãªã©ã®æ¥­å‹™ã‚‚ã”ã–ã„ã¾ã™ã®ã§ã€çµŒé¨“ã‚’æ´»ã‹ã—ã¦ã‚¹ãƒ ãƒ¼ã‚ºã«å¯¾å¿œã§ãã‚‹æ–¹ã€å¤§æ­“è¿ã§ã™ï¼\n\nã€æ¥­å‹™å†…å®¹ã€‘\nãƒ¬ã‚¸æ¥­å‹™ï¼ˆæ¥å®¢ãƒ»ç²¾ç®—ãƒ»å…¬å…±æ–™é‡‘ç­‰ã®å¯¾å¿œï¼‰\nå•†å“ã®å“å‡ºã—ãƒ»é™³åˆ—\nãƒ•ãƒ©ã‚¤ãƒ¤ãƒ¼å•†å“ã®èª¿ç†ãƒ»è£œå……\næ´—ã„ç‰©å…¨èˆ¬ï¼ˆãƒˆãƒ³ã‚°ãƒ»ãƒ•ãƒ©ã‚¤ãƒ¤ãƒ¼å‚™å“ãªã©ï¼‰\nå»ƒæ£„ç‰©ã®å›åãƒ»å‡¦ç†\nãªã©\n\nçŸ­æ™‚é–“ã§ã‚‚å³æˆ¦åŠ›ã¨ã—ã¦åƒã‘ã‚‹æ–¹ã®ã”å¿œå‹Ÿã‚’ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼","items":["ãƒœãƒ¼ãƒ«ãƒšãƒ³ãƒ»ãƒ¡ãƒ¢å¸³","æœ¬äººç¢ºèªæ›¸é¡ï¼ˆé‹è»¢å…è¨±è¨¼ã‚„ä¿é™ºè¨¼ãªã©ï¼‰","(â€»å¤–å›½ç±ã®æ–¹ã®ã¿ï¼‰åœ¨ç•™ã‚«ãƒ¼ãƒ‰ã€ãƒ‘ã‚¹ãƒãƒ¼ãƒˆ"],"conditions":["ç›´è¿‘3å¹´ä»¥å†…ã«ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆã§ã®ãƒ¬ã‚¸çµŒé¨“ã®ã‚ã‚‹æ–¹","ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ã—ãªã„æ–¹ï¼ˆä¸‡ãŒä¸€å‹¤å‹™ãŒé›£ã—ããªã£ãŸå ´åˆã¯æ—©ã‚ã«ã”é€£çµ¡ã€ã”ç›¸è«‡ãã ã•ã„ï¼‰","åƒãå‰ã®è³ªå•ã«å›ç­”ã„ãŸã ã‘ã‚‹æ–¹","æ·»ä»˜ã®èª“ç´„æ›¸ã€å°±æ¥­å‰ç¢ºèªäº‹é …ã‚’ã”ç¢ºèªã„ãŸã ãã€å½“æ—¥æœ¬äººç¢ºèªæ›¸é¡ã‚’ãŠæŒã¡ã„ãŸã ã‘ã‚‹æ–¹","ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆãŒ4ä»¥ä¸‹ãƒ»GOODç‡80%ä»¥ä¸Šãƒ»ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ10%ä»¥ä¸‹ã®æ–¹"],"notes":"â€»å¿…ãšã”ç¢ºèªãã ã•ã„â€»\n\nã€å‹¤å‹™å½“æ—¥ã«ã¤ã„ã¦ã€‘\nãƒ»åˆå›å‹¤å‹™æ™‚ã«ã¯ã€ã”æœ¬äººæ§˜ç¢ºèªã®ãŸã‚ã€æœ¬äººç¢ºèªæ›¸é¡ã®ã”æç¤ºã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚â€»å½“æ—¥ãŠå¿˜ã‚Œã®å ´åˆã¯ã€å°±æ¥­ã‚’ãŠæ–­ã‚Šã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚\nãƒ»æ·»ä»˜ã®ã€å°±æ¥­å‰ç¢ºèªäº‹é …ã€‘ã‚’äº‹å‰ã«ã”ç¢ºèªã„ãŸã ãã€å½“æ—¥ã”æå‡ºãã ã•ã„ã€‚\nãƒ»ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã‚’éµå®ˆã„ãŸã ã‘ãªã„å ´åˆã¯ã€å¿œå‹Ÿ/å‹¤å‹™æ¡ä»¶ã‚’æº€ãŸã•ãªã„ãŸã‚ã€å°±æ¥­ã‚’ãŠæ–­ã‚Šã„ãŸã—ã¾ã™ã€‚ãã®å ´åˆã€å½“æ—¥ã®å ±é…¬ï¼ˆäº¤é€šè²»ã‚’å«ã‚€ï¼‰ã¯ãŠæ”¯æ‰•ã„ã§ãã¾ã›ã‚“ã®ã§ã”äº†æ‰¿ãã ã•ã„ã€‚\n\nã€ãƒˆãƒ©ãƒ–ãƒ«ç™ºç”Ÿæ™‚ã®å¯¾å¿œã«ã¤ã„ã¦ã€‘\nãƒ»åº—èˆ—ã«è¨­ç½®ã•ã‚ŒãŸé˜²çŠ¯ã‚«ãƒ¡ãƒ©ã¯ã€çŠ¯ç½ªã®é˜²æ­¢ãªã‚‰ã³ã«ãŠå®¢æ§˜ãŠã‚ˆã³å¾“æ¥­å“¡ã®å®‰å…¨ç¢ºä¿ã‚’ç›®çš„ã¨ã—ã¦æ’®å½±ãƒ»éŒ²ç”»ã—ã¦ãŠã‚Šã¾ã™ã€‚\nãƒ»çŠ¯ç½ªãã®ä»–ä¸æ­£è¡Œç‚ºã®å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã¯ã€ç›£è¦–ãƒ»éŒ²ç”»å†…å®¹ã‚’ç¢ºèªã„ãŸã—ã¾ã™ã€‚\nãƒ»ãƒ¬ã‚¸ç¾é‡‘ã®å¼•ãæŠœãã‚„å•†å“ã®æŒã¡å‡ºã—ãªã©ã€æ•…æ„ã¾ãŸã¯éå¤±ã«ã‚ˆã‚Šå½“åº—ãŒæå®³ã‚’è¢«ã£ãŸå ´åˆã€æ³•ä»¤ã«åŸºã¥ãæå®³è³ å„Ÿã‚’è«‹æ±‚ã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚\n\nã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«ã¤ã„ã¦ã€‘\nãƒ»ç›´å‰ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ã€åº—èˆ—ã‚„ä»–ã®å¾“æ¥­å“¡ã«å¤šå¤§ãªå½±éŸ¿ã‚’ä¸ãˆã¾ã™ã€‚\nãƒ»ã‚„ã‚€ã‚’å¾—ãšå‡ºå‹¤ã§ããªã„å ´åˆã¯ã€äº‹å‰ã«ï¼ˆ2æ—¥å‰ã¾ã§ï¼‰ã”é€£çµ¡ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚\nãƒ»ä¸Šè¨˜ç†ç”±ã‹ã‚‰ã€ç¢ºå®Ÿã«å‹¤å‹™å¯èƒ½ãªå ´åˆã®ã¿ã”å¿œå‹Ÿãã ã•ã„ã€‚\nãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸæ–¹ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ã®é«˜ã„æ–¹ã¯ã€ãŠæ–­ã‚Šã•ã›ã¦ã„ãŸã ãå ´åˆãŒã”ã–ã„ã¾ã™ã€‚\n\nã€èº«ã ã—ãªã¿ã«ã¤ã„ã¦ã€‘\nãƒ»æ¸…æ½”æ„Ÿã®ã‚ã‚‹èº«ã ã—ãªã¿ã§å‹¤å‹™ã—ã¦ãã ã•ã„ã€‚ï¼ˆãƒ™ãƒ¼ã‚¸ãƒ¥ã®ãƒãƒãƒ‘ãƒ³ç­‰ã®æŒ‡å®šã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰\nãƒ»ã²ã’ã€ãƒãƒ‹ã‚­ãƒ¥ã‚¢ï¼ˆã¤ã‘çˆªï¼‰ã€åŠã‚ºãƒœãƒ³ã€ã‚¹ã‚«ãƒ¼ãƒˆã¯ã”é æ…®ãã ã•ã„ã€‚\nãƒ»æ»‘ã‚Šã«ãã„é´ã§ãŠè¶Šã—ãã ã•ã„ã€‚ï¼ˆãƒ’ãƒ¼ãƒ«ã€ã‚µãƒ³ãƒ€ãƒ«ä¸å¯ï¼‰\nãƒ»åˆ¶æœã¯ãŠè²¸ã—ã„ãŸã—ã¾ã™ã€‚\n\nã€é¡”å†™çœŸç™»éŒ²ã®ãŠé¡˜ã„ã€‘\nå††æ»‘ãªãƒãƒƒãƒãƒ³ã‚°ã¨å½“æ—¥ã®ã‚¹ãƒ ãƒ¼ã‚ºãªæ¥­å‹™é–‹å§‹ã®ãŸã‚é¡”å†™çœŸã®ã”ç™»éŒ²ãŒãªã„ãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã«ã¤ãã¾ã—ã¦ã¯ã€ãŠç”³ã—è¾¼ã¿ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã›ã¦ã„ãŸã ãå ´åˆãŒã”ã–ã„ã¾ã™ã€‚ã”ç†è§£ã”å”åŠ›ã®ã»ã©ã€ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚","benefits":["äº¤é€šè²»æ”¯çµ¦","åˆ¶æœè²¸ä¸"]},];
        const originalTemplates = [{ "concept": "ã€æ—¢å­˜ã€‘ã‚³ãƒ³ãƒ“ãƒ‹æœªçµŒé¨“è€…æ­“è¿", "keywords": ["æœªçµŒé¨“", "ã‚³ãƒ³ãƒ“ãƒ‹", "åˆå¿ƒè€…", "å­¦ç”Ÿ", "ãƒ‡ãƒ“ãƒ¥ãƒ¼", "æ¸…æƒ"], "industry_type": "è²©å£² / ã‚³ãƒ³ãƒ“ãƒ‹ãƒ»ã‚¹ãƒ¼ãƒ‘ãƒ¼", "title": "ğŸ”°ã€æœªçµŒé¨“å¤§æ­“è¿ã€‘ã‚³ãƒ³ãƒ“ãƒ‹ãƒ‡ãƒ“ãƒ¥ãƒ¼å¿œæ´ï¼ç°¡å˜æ¥­å‹™ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ", "description": "ãƒ¬ã‚¸ã€å“å‡ºã—ã€æ¸…æƒãªã©ã€ã‚³ãƒ³ãƒ“ãƒ‹æ¥­å‹™å…¨èˆ¬ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚åˆã‚ã¦ã®æ–¹ã§ã‚‚ã€ç ”ä¿®å‹•ç”»ã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒã—ã£ã‹ã‚Šã—ã¦ã„ã‚‹ã®ã§å®‰å¿ƒã§ã™ã€‚å„ªã—ã„å…ˆè¼©ã‚¹ã‚¿ãƒƒãƒ•ãŒä¸å¯§ã«æ•™ãˆã¾ã™ï¼", "benefits": ["äº¤é€šè²»æ”¯çµ¦", "åˆ¶æœè²¸ä¸", "æœªçµŒé¨“è€…æ­“è¿"], "items": ["å‹•ãã‚„ã™ã„æœè£…", "ãƒ¡ãƒ¢å¸³", "ãƒœãƒ¼ãƒ«ãƒšãƒ³"], "conditions": ["æ˜ã‚‹ãå…ƒæ°—ãªæŒ¨æ‹¶ãŒã§ãã‚‹æ–¹", "æ™‚é–“ã‚’å®ˆã‚Œã‚‹æ–¹"], "notes": "ãŠåº—ã«ç€ãã¾ã—ãŸã‚‰ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ›ãƒ³ã§ã€ã‚¿ã‚¤ãƒŸãƒ¼ã‹ã‚‰æ¥ã¾ã—ãŸã€ã¨ãŠä¼ãˆãã ã•ã„ã€‚" }, { "concept": "ã€æ—¢å­˜ã€‘ã‚³ãƒ³ãƒ“ãƒ‹çµŒé¨“è€…é™å®š", "keywords": ["çµŒé¨“è€…", "ã‚³ãƒ³ãƒ“ãƒ‹", "å³æˆ¦åŠ›", "ãƒ–ãƒ©ãƒ³ã‚¯OK"], "industry_type": "è²©å£² / ã‚³ãƒ³ãƒ“ãƒ‹ãƒ»ã‚¹ãƒ¼ãƒ‘ãƒ¼", "title": "âœ¨ã€ã‚³ãƒ³ãƒ“ãƒ‹çµŒé¨“è€…é™å®šã€‘ã‚¹ã‚­ãƒ«ã‚’æ´»ã‹ã›ã‚‹ï¼é«˜å¾…é‡ã‚¹ã‚¿ãƒƒãƒ•", "description": "ã‚³ãƒ³ãƒ“ãƒ‹ã§ã®å‹¤å‹™çµŒé¨“ã‚’æ´»ã‹ã—ã¦ã€å³æˆ¦åŠ›ã¨ã—ã¦æ´»èºã—ã¦ãã ã•ã„ï¼ä¸»ã«ãŠä»»ã›ã™ã‚‹ã®ã¯ãƒ¬ã‚¸æ¥­å‹™ã¨ãŠå®¢æ§˜å¯¾å¿œã§ã™ã€‚ã‚ãªãŸã®åŠ›ã‚’è²¸ã—ã¦ãã ã•ã„ï¼ãƒ–ãƒ©ãƒ³ã‚¯ã®ã‚ã‚‹æ–¹ã‚‚å¤§æ­“è¿ã§ã™ã€‚", "benefits": ["äº¤é€šè²»æ”¯çµ¦", "åˆ¶æœè²¸ä¸"], "items": ["é»’ã„ã‚ºãƒœãƒ³", "ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼"], "conditions": ["ã‚³ãƒ³ãƒ“ãƒ‹ã§ã®å‹¤å‹™çµŒé¨“ãŒåŠå¹´ä»¥ä¸Šã‚ã‚‹æ–¹", "ãƒ†ã‚­ãƒ‘ã‚­ã¨å‹•ã‘ã‚‹æ–¹"], "notes": "é…åˆ»ã¯å³ç¦ã§ã™ã€‚ä¸‡ãŒä¸€é…ã‚Œã‚‹å ´åˆã¯ã€å¿…ãšç·Šæ€¥é€£çµ¡å…ˆã«ãŠé›»è©±ãã ã•ã„ã€‚" }];
        const documentTemplates2 = [{"concept":"ã€æ–‡æ›¸ã€‘ãƒ­ãƒ¼ã‚½ãƒ³ ãƒ¬ã‚¸çµŒé¨“è€…","keywords":["ãƒ­ãƒ¼ã‚½ãƒ³","çµŒé¨“è€…","ãƒ¬ã‚¸","å•†å“é™³åˆ—","æ¸…æƒ"],"industry_type":"è²©å£² / ã‚³ãƒ³ãƒ“ãƒ‹ãƒ»ã‚¹ãƒ¼ãƒ‘ãƒ¼","title":"ã€åº—èˆ—åã€‘ï¼Šãƒ­ãƒ¼ã‚½ãƒ³å‹¤å‹™çµŒé¨“è€…é™å®šï¼Šãƒ¬ã‚¸/å•†å“é™³åˆ—ã®ãŠä»•äº‹","description":"ï¼Šãƒ­ãƒ¼ã‚½ãƒ³çµŒé¨“è€…å¤§æ­“è¿ï¼Š\n\nä¸»ãªä»•äº‹å†…å®¹ã¨ã—ã¦ã¯ã€\nãƒ»ãƒ¬ã‚¸\nãƒ»å•†å“é™³åˆ—\nãƒ»åº—å†…æ¸…æƒï¼ˆåºŠãƒ»ãƒˆã‚¤ãƒ¬æ¸…æƒãªã©ï¼‰\n\nä»–ã«ã‚‚ä¸‹è¨˜æ¥­å‹™ã‚’ãŠé¡˜ã„ã™ã‚‹ã“ã¨ã‚‚ã”ã–ã„ã¾ã™ã€‚\nãƒ»ãƒ•ãƒ©ã‚¤ãƒ¤ãƒ¼ã‚„ãƒˆã‚¤ãƒ¬ãªã©ã®æ¸…æƒæ¥­å‹™\nãƒ»ã‚³ãƒ¼ãƒ’ãƒ¼ãƒã‚·ãƒ³ãªã©åº—å†…è¨­å‚™ã®æ¸…æƒ\nãƒ»ãƒã‚¹ã‚¿ãƒ¼ãªã©ã®è²©ä¿ƒç‰©è¨­ç½®\n\næ˜ã‚‹ã„ç¬‘é¡”ã§ãŠå®¢æ§˜ã¸æ¥ã—ã¾ã—ã‚‡ã†ï¼\nåˆ†ã‹ã‚‰ãªã„ã“ã¨ã¯å‘¨ã‚Šã®ã‚¹ã‚¿ãƒƒãƒ•ã«èã„ã¦ãã ã•ã„ã­ï¼\nå„ªã—ãä¸å¯§ã«ãŠæ•™ãˆã—ã¾ã™â™ª","items":["ãƒœãƒ¼ãƒ«ãƒšãƒ³ãƒ»ãƒ¡ãƒ¢å¸³","é•·ã‚ºãƒœãƒ³","å‹•ãã‚„ã™ã„ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼"],"conditions":["ãƒ­ãƒ¼ã‚½ãƒ³ã§ã®ãƒ¬ã‚¸å‹¤å‹™çµŒé¨“ãŒã‚ã‚‹æ–¹","ãƒãƒƒãƒãƒ³ã‚°å¾Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ˆã‚Šåˆ¶æœã®ã‚µã‚¤ã‚ºã¨ã‚³ãƒ³ãƒ“ãƒ‹å‹¤å‹™æ­´ã«ã¤ã„ã¦ã”é€£çµ¡ãã ã•ã„ã€‚\nï¼ˆé€£çµ¡ã„ãŸã ã‘ãªã„å ´åˆã€ãƒãƒƒãƒãƒ³ã‚°ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã›ã¦ã„ãŸã ãã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰"],"notes":"ã€åˆ°ç€ã€‘\nãŠåº—ã«ç€ã„ãŸã‚‰ã€ä¸€èˆ¬ã®ãŠå®¢æ§˜ã¨åŒã˜ã‚ˆã†ã«åº—èˆ—å…¥å£ã‹ã‚‰å…¥åº—ã—ã€è¿‘ãã®åº—å“¡ã«ã€Œã‚¿ã‚¤ãƒŸãƒ¼ã‹ã‚‰åƒãã«æ¥ã¾ã—ãŸã€ã¨ãŠä¼ãˆãã ã•ã„ã€‚\næ‹…å½“è€…ãŒåˆ¶æœã¸ã®ç€æ›¿ãˆãªã©ã‚’ã”æ¡ˆå†…ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\nã€æœè£…ãƒ»é«ªå‹ã€‘\né«­ã¯NGã§ã™ã€‚\né«ªãŒè‚©ã«ã¤ãæ–¹ã¯ä¸€ã¤ã«çµã‚“ã§ã„ãŸã ãã¾ã™ã€‚\nãƒã‚¤ãƒ«ã€é¦™æ°´ã¯ãŠæ§ãˆãã ã•ã„ã€‚\nãƒ”ã‚¢ã‚¹ã€ãƒãƒƒã‚¯ãƒ¬ã‚¹ã€æŒ‡è¼ªã‚„ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ã¯å‡ºå‹¤æ™‚ã«å¤–ã—ã¦ãã ã•ã„ã€‚\n\nã€é…åˆ»ã€‘\né…åˆ»ã¯å³ç¦ã§ã™ï¼é…ã‚Œãªã„ã‚ˆã†ã«ã”å‡ºå‹¤ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\nä¸‡ãŒä¸€é…ã‚Œã‚‹å ´åˆã«ã¯ã€ç·Šæ€¥é€£çµ¡å…ˆã«ã”é€£çµ¡ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã¯å½“æ—¥ã§ã®å¯¾å¿œãŒã§ããªã„ãŸã‚ï¼‰ã€‚","benefits":["äº¤é€šè²»æ”¯çµ¦","åˆ¶æœè²¸ä¸"]},];
        const existingTemplates = [...documentTemplates1, ...originalTemplates, ...documentTemplates2];

        const generateBtn = page.querySelector('#generateBtn');
        if (generateBtn) {
            generateBtn.addEventListener('click', () => {
                const industry = page.querySelector('#industry').value;
                const workDetails = page.querySelector('#work-details').value.trim();
                const needs = page.querySelector('#needs').value.trim();
                const resultDiv = page.querySelector('#result');
                const initialMessage = page.querySelector('#initial-message');

                resultDiv.innerHTML = '';
                if (initialMessage) initialMessage.style.display = 'none';

                if (!needs && !workDetails) {
                    resultDiv.innerHTML = createAlertHTML('å…¥åŠ›ã‚¨ãƒ©ãƒ¼', 'ã€ŒãŠå®¢æ§˜ã®ãƒ‹ãƒ¼ã‚ºãƒ»èª²é¡Œã€ã¾ãŸã¯ã€Œå…·ä½“çš„ãªæ¥­å‹™å†…å®¹ã€ã®ã„ãšã‚Œã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const suggestions = generateSuggestions(industry, needs, workDetails, existingTemplates);

                if (suggestions.length === 0) {
                    resultDiv.innerHTML = createAlertHTML('ææ¡ˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰ãˆã‚‹ã‹ã€æ¥­ç¨®ã‚’å¤‰ãˆã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚', 'info');
                    return;
                }

                let tabsHtml = '<div class="flex border-b border-slate-200 bg-white rounded-t-lg overflow-x-auto">';
                let panelsHtml = '<div>';

                suggestions.forEach((s, index) => {
                    const isActive = index === 0;
                    const tabTitle = s.concept.replace(/ã€.*?ã€‘|AIææ¡ˆ:\s*/g, '').trim();
                    let tabLabel = `ææ¡ˆ${index + 1}`;
                    if(s.concept.startsWith('AIææ¡ˆ: èª²é¡Œè§£æ±ºãƒ—ãƒ©ãƒ³')) {
                        tabLabel = 'â­ï¸èª²é¡Œè§£æ±ºææ¡ˆ';
                    } else if (s.concept.startsWith('AIææ¡ˆ: æœ€é©åŒ–ãƒ—ãƒ©ãƒ³')) {
                        tabLabel = 'â­ï¸æœ€é©åŒ–ææ¡ˆ';
                    }
                    tabsHtml += `<button class="tab ${isActive ? 'active' : ''}" data-tab-target="#panel-${index}">${tabLabel}${!tabLabel.startsWith('â­ï¸') ? `: ${tabTitle}` : ''}</button>`;
                    panelsHtml += `<div id="panel-${index}" class="tab-panel ${!isActive ? 'hidden' : ''}">${createSuggestionCard(s, index)}</div>`;
                });

                tabsHtml += '</div>';
                panelsHtml += '</div>';
                resultDiv.innerHTML = tabsHtml + panelsHtml;

                attachCopyListeners();
                attachTabListeners();
            });
        }
    }
    function createSuggestionCard(s, index) {
        const today = new Date();
        const formattedDate = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥(${['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][today.getDay()]})`;
        let formattedConditions = Array.isArray(s.conditions) ? s.conditions.join('\n') : s.conditions;
        if (s.highlightConditions) {
            s.highlightConditions.forEach(cond => {
                const regex = new RegExp(cond.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "g");
                formattedConditions = formattedConditions.replace(regex, `<span class="highlight-condition">$&</span>`);
            });
        }
        formattedConditions = 'ãƒ»' + formattedConditions.replace(/\n/g, '\nãƒ»');
        return `
        <div class="bg-white rounded-b-lg shadow-sm border-l border-r border-b border-slate-200 overflow-hidden">
            <div class="h-32 bg-slate-200 flex items-center justify-center"><p class="text-slate-500">åº—èˆ—ãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒ (ä¾‹)</p></div>
            <div class="p-6 md:p-8">
                <p class="text-xs text-slate-500 mb-2">${s.industry_type}</p>
                <h2 id="title-content-${index}" class="text-xl font-bold text-slate-800 leading-tight">${s.title}</h2>
                <button class="copy-btn" data-clipboard-target-id="title-content-${index}">ã‚³ãƒ”ãƒ¼</button>
                <div class="text-sm text-slate-700 mt-3"><p>ğŸ•’ ${formattedDate} 18:00 ~ 22:00 (ä¼‘æ†©ãªã—)</p></div>
                <div class="flex justify-between items-center mt-4 text-sm">
                    <p class="text-slate-500">ã‚ã¨5æ™‚é–“ã§å‹Ÿé›†ç· ã‚åˆ‡ã‚Š</p>
                    <p class="bg-red-100 text-red-700 font-bold py-1 px-3 rounded-md">å‹Ÿé›†äººæ•° 1/2äºº</p>
                </div>
                <hr class="my-6 border-slate-200"><div class="text-2xl font-bold text-slate-800">Â¥5,200</div>
                <p class="text-xs text-slate-500">æ™‚çµ¦ Â¥1,300</p>
                <p class="text-xs text-slate-500">äº¤é€šè²» Â¥700 å«ã‚€</p>
                <hr class="my-6 border-slate-200">
                <div class="space-y-8">
                    ${createSection('å¾…é‡', `benefits-content-${index}`, createBenefitsContent(s.benefits))}
                    ${createSection('æ¥­å‹™å†…å®¹', `description-content-${index}`, s.description)}
                    ${createSection('æŒã¡ç‰©', `items-content-${index}`, Array.isArray(s.items) ? 'ãƒ»' + s.items.join('\nãƒ»') : s.items)}
                    ${createSection('åƒããŸã‚ã®æ¡ä»¶', `conditions-content-${index}`, formattedConditions)}
                    ${createSection('æ³¨æ„äº‹é …', `notes-content-${index}`, s.notes)}
                </div>
                <div id="explanation-box-${index}" class="explanation-box mt-8 p-4 rounded-lg">
                    <h4 class="font-bold text-slate-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-sky-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                        <span>ã“ã®ææ¡ˆã®ãƒã‚¤ãƒ³ãƒˆè§£èª¬</span>
                    </h4>
                    <div class="text-sm text-slate-700 mt-2 leading-relaxed" id="explanation-content-${index}">${s.explanation || 'ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å…¥åŠ›ã•ã‚ŒãŸã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¨ã®é–¢é€£æ€§ãŒé«˜ã„ãŸã‚ææ¡ˆã—ã¾ã™ã€‚'}</div>
                </div>
            </div>
        </div>`;
    }
    function createSection(label, id, content) { return `<div><h3 class="section-header">${label}<button class="copy-btn" data-clipboard-target-id="${id}">ã‚³ãƒ”ãƒ¼</button></h3><div class="section-content" id="${id}">${content}</div></div>`; }
    function createBenefitsContent(benefits) { const iconMap = {'äº¤é€šè²»æ”¯çµ¦': 'ğŸš†','ã¾ã‹ãªã„ã‚ã‚Š': 'ğŸœ','æœªçµŒé¨“è€…æ­“è¿': 'ğŸ”°','åˆ¶æœè²¸ä¸': 'ğŸ‘•','é«ªå‹ï¼ã‚«ãƒ©ãƒ¼è‡ªç”±': 'ğŸ¨','ãƒã‚¤ã‚¯ï¼è»Šé€šå‹¤å¯': 'ğŸš—'}; return Array.isArray(benefits) ? benefits.map(b => `<p class="flex items-center">${iconMap[b] || 'âœ…'} <span class="ml-2">${b}</span></p>`).join('') : ''; }
    function createAlertHTML(title, message, type = 'error') { const colors = { error: { bg: 'bg-rose-100', border: 'border-rose-500', text: 'text-rose-700' }, info: { bg: 'bg-sky-100', border: 'border-sky-500', text: 'text-sky-700' } }; return `<div class="${colors[type].bg} border-l-4 ${colors[type].border} ${colors[type].text} p-4 rounded-lg" role="alert"><p><strong>${title}</strong>: ${message}</p></div>`; }
    function attachCopyListeners() { document.querySelectorAll('.copy-btn').forEach(button => { button.addEventListener('click', (e) => { e.stopPropagation(); const targetId = button.getAttribute('data-clipboard-target-id'); const contentEl = document.getElementById(targetId); if (!contentEl) return; const tempEl = contentEl.cloneNode(true); tempEl.querySelectorAll('.highlight-point, .highlight-condition').forEach(el => { el.outerHTML = el.innerHTML; }); const content = tempEl.innerText; const textArea = document.createElement('textarea'); textArea.value = content; textArea.style.position = 'fixed'; textArea.style.top = '-9999px'; document.body.appendChild(textArea); textArea.select(); try { document.execCommand('copy'); button.innerHTML = 'ã‚³ãƒ”ãƒ¼å®Œäº†!'; button.classList.add('copied-feedback'); setTimeout(() => { button.innerHTML = 'ã‚³ãƒ”ãƒ¼'; button.classList.remove('copied-feedback'); }, 1500); } catch (err) { console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ', err); } finally { document.body.removeChild(textArea); } }); }); }
    function attachTabListeners() { const page = document.getElementById('page-generator'); if (!page) return; const tabs = page.querySelectorAll('.tab'); const panels = page.querySelectorAll('.tab-panel'); tabs.forEach(tab => { tab.addEventListener('click', () => { tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); const target = page.querySelector(tab.dataset.tabTarget); panels.forEach(p => p.classList.add('hidden')); if (target) target.classList.remove('hidden'); }); }); }
    function generateSuggestions(industry, needs, workDetails, existingTemplates) {
        const intentSolutions={"ãƒãƒƒãƒãƒ³ã‚°":{type:"negative",solution:{titlePhrase:"ğŸ”°æœªçµŒé¨“è€…ã•ã‚“å¤§æ­“è¿ï¼ğŸ”°",descriptionPhrase:"ç‰¹åˆ¥ãªã‚¹ã‚­ãƒ«ã¯ä¸è¦ï¼ç°¡å˜ãªä½œæ¥­ã‹ã‚‰ä¸å¯§ã«ãŠæ•™ãˆã—ã¾ã™ã®ã§ã€å®‰å¿ƒã—ã¦ã”å¿œå‹Ÿãã ã•ã„ã€‚",conditions:["Goodç‡85%ä»¥ä¸Šã®æ–¹","æ™‚é–“ã‚’å®ˆã‚Œã‚‹æ–¹","ãŠåº—ã®ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã£ã¦æ¥½ã—ãåƒã‘ã‚‹æ–¹"],highlightConditions:["Goodç‡85%ä»¥ä¸Šã®æ–¹"],benefits:["æœªçµŒé¨“è€…æ­“è¿"],explanation:(e,t)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®èª²é¡Œï¼š</b> ã€Œ${t}ã€</div><div class="explanation-interpretation"><b>AIã®è§£é‡ˆï¼š</b> å¿œå‹ŸãŒé›†ã¾ã‚‰ãšã€äººæ‰‹ãŒç¢ºä¿ã§ããªã‹ã£ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b> ã‚ˆã‚Šå¤šãã®ãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã«å¿œå‹Ÿã—ã¦ã‚‚ã‚‰ãˆã‚‹ã‚ˆã†ã€å¿œå‹Ÿã®ãƒãƒ¼ãƒ‰ãƒ«ã‚’å°‘ã—ä¸‹ã’ã¤ã¤ã€ä»•äº‹ã®é­…åŠ›ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã™ã‚‹åŸç¨¿ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†ã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><ul><li><b>â‘ ã‚¿ã‚¤ãƒˆãƒ«ï¼š</b>ã€Œ<span class="highlight-point">ğŸ”°æœªçµŒé¨“è€…ã•ã‚“å¤§æ­“è¿ï¼ğŸ”°</span>ã€ã®ã‚ˆã†ã«ã€å¿œå‹Ÿã®ã—ã‚„ã™ã•ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã—ã¾ã™ã€‚</li><li><b>â‘¡æ¥­å‹™å†…å®¹ï¼š</b>ã€Œ<span class="highlight-point">ç°¡å˜ãªä½œæ¥­ã‹ã‚‰ä¸å¯§ã«ãŠæ•™ãˆã—ã¾ã™</span>ã€ã¨ã„ã†ä¸€æ–‡ã§ã€åˆã‚ã¦ã®æ–¹ã®ä¸å®‰ã‚’æ‰•æ‹­ã—ã¾ã™ã€‚</li><li><b>â‘¢åƒããŸã‚ã®æ¡ä»¶ï¼š</b>å¿œå‹Ÿã®æ¯æ•°ã‚’å¢—ã‚„ã™ãŸã‚ã€ã€ŒGoodç‡90%ä»¥ä¸Šã€ã‹ã‚‰ã€Œ<span class="highlight-condition">Goodç‡85%ä»¥ä¸Šã®æ–¹</span>ã€ã¸ã¨åŸºæº–ã‚’å°‘ã—ç·©å’Œã—ã¾ã™ã€‚ä¸€æ–¹ã§ã€ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ã®åŸºæº–ã¯ç¶­æŒã™ã‚‹ã“ã¨ã§ã€å‹¤å‹™æ…‹åº¦ã®ä¿¡é ¼æ€§ã¯æ‹…ä¿ã—ã¾ã™ã€‚</li></ul></div>`}},"ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«":{type:"negative",solution:{titlePhrase:"âœ¨äººæ°—ã®ãŠä»•äº‹ï¼ã”å¿œå‹Ÿã¯ãŠæ—©ã‚ã«âœ¨",conditions:["ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹","Goodç‡95%ä»¥ä¸Šã®æ–¹"],highlightConditions:["ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹","Goodç‡95%ä»¥ä¸Šã®æ–¹"],explanation:(e,t)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®èª²é¡Œï¼š</b> ã€Œ${t}ã€</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b> ã‚¿ã‚¤ãƒˆãƒ«ã§ç›´æ¥çš„ã«è­¦å‘Šã™ã‚‹ã‚ˆã‚Šã€å¿œå‹Ÿæ¡ä»¶ã‚’å°‘ã—å³ã—ãã—ã¦ã€ä¿¡é ¼ã§ãã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã‹ã‚‰å¿œå‹Ÿã‚’é›†ã‚ã‚‹æ–¹ãŒåŠ¹æœçš„ã§ã™ã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><br>ã€ŒåƒããŸã‚ã®æ¡ä»¶ã€ã«ä»¥ä¸‹ã®2ç‚¹ã‚’è¿½åŠ ãƒ»å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™ã€‚<br><ul><li>ãƒ»<span class="highlight-condition">ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹</span></li><li>ãƒ»<span class="highlight-condition">Goodç‡95%ä»¥ä¸Šã®æ–¹</span></li></ul>ã“ã‚Œã«ã‚ˆã‚Šã€å‹¤å‹™æ…‹åº¦ãŒè‰¯å¥½ãªãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã‹ã‚‰ã®å¿œå‹Ÿã«ç¹‹ãŒã‚Šã‚„ã™ããªã‚Šã€çµæœçš„ã«ç›´å‰ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«é˜²æ­¢ã«ç¹‹ãŒã‚Šã¾ã™ã€‚</div>`}},ã°ã£ãã‚Œ:{type:"negative",solution:{titlePhrase:"âœ¨äººæ°—ã®ãŠä»•äº‹ï¼ã”å¿œå‹Ÿã¯ãŠæ—©ã‚ã«âœ¨",conditions:["ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹","Goodç‡95%ä»¥ä¸Šã®æ–¹"],highlightConditions:["ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹","Goodç‡95%ä»¥ä¸Šã®æ–¹"],explanation:(e,t)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®èª²é¡Œï¼š</b> ã€Œ${t}ã€</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b> ã‚¿ã‚¤ãƒˆãƒ«ã§ç›´æ¥çš„ã«è­¦å‘Šã™ã‚‹ã‚ˆã‚Šã€å¿œå‹Ÿæ¡ä»¶ã‚’å°‘ã—å³ã—ãã—ã¦ã€ä¿¡é ¼ã§ãã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã‹ã‚‰å¿œå‹Ÿã‚’é›†ã‚ã‚‹æ–¹ãŒåŠ¹æœçš„ã§ã™ã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><br>ã€ŒåƒããŸã‚ã®æ¡ä»¶ã€ã«ä»¥ä¸‹ã®2ç‚¹ã‚’è¿½åŠ ãƒ»å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™ã€‚<br><ul><li>ãƒ»<span class="highlight-condition">ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ5%ä»¥ä¸‹ã®æ–¹</span></li><li>ãƒ»<span class="highlight-condition">Goodç‡95%ä»¥ä¸Šã®æ–¹</span></li></ul>ã“ã‚Œã«ã‚ˆã‚Šã€å‹¤å‹™æ…‹åº¦ãŒè‰¯å¥½ãªãƒ¯ãƒ¼ã‚«ãƒ¼æ§˜ã‹ã‚‰ã®å¿œå‹Ÿã«ç¹‹ãŒã‚Šã‚„ã™ããªã‚Šã€çµæœçš„ã«ç„¡æ–­æ¬ å‹¤ã®é˜²æ­¢ã«ç¹‹ãŒã‚Šã¾ã™ã€‚</div>`}},çµŒé¨“è€…:{type:"positive",solution:{titlePhrase:"âœ¨çµŒé¨“è€…ã€å¤§æ­“è¿ï¼ã‚¹ã‚­ãƒ«ã‚’æ´»ã‹ã›ã‚‹ãŠä»•äº‹âœ¨",descriptionPhrase:'ä»Šå›ã¯ç‰¹ã«<span class="highlight-point">çµŒé¨“è€…</span>ã®æ–¹ã‚’æ­“è¿ã—ã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®ã‚¹ã‚­ãƒ«ã‚„çµŒé¨“ã‚’ãœã²å½“åº—ã§æ´»ã‹ã—ã¦ãã ã•ã„ã€‚',explanation:(e,t,o)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®ã”è¦æœ›ï¼š</b> ã€Œ${t}ã€</div><div class="explanation-interpretation"><b>AIã®è§£é‡ˆï¼š</b> ãŠå®¢æ§˜ã¯ã€Œ<b>çµŒé¨“è€…</b>ã€ã‚’å‹Ÿé›†ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b><br>ãŠå®¢æ§˜ã®ã”è¦æœ›ã‚’å¶ãˆã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2ç‚¹ã‚’ç››ã‚Šè¾¼ã‚“ã å°‚ç”¨åŸç¨¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><ul><li><b>â‘ ã‚¿ã‚¤ãƒˆãƒ«ï¼š</b>ã€Œ<span class="highlight-point">${o}</span>ã€ã¨ã„ã†ã‚­ãƒ£ãƒƒãƒãƒ¼ãªæ–‡è¨€ã§ã€çµŒé¨“è€…ã®å¿œå‹Ÿã‚’ä¿ƒã—ã¾ã™ã€‚</li><li><b>â‘¡æ¥­å‹™å†…å®¹ï¼š</b>ãƒ¡ã‚¤ãƒ³æ¥­å‹™ãŒã€Œ<span class="highlight-point">${e}</span>ã€ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ä¼ãˆã€ã•ã‚‰ã«ã€Œ<span class="highlight-point">çµŒé¨“è€…</span>ã€ã‚’æ­“è¿ã™ã‚‹ä¸€æ–‡ã‚’è¿½åŠ ã—ã¦ã€ãƒŸã‚¹ãƒãƒƒãƒã‚’é˜²ãã¾ã™ã€‚</li></ul></div>`}},æœªçµŒé¨“:{type:"positive",solution:{titlePhrase:"ğŸ”°æœªçµŒé¨“ã§ã‚‚å®‰å¿ƒï¼ã‚«ãƒ³ã‚¿ãƒ³ä½œæ¥­ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆğŸ”°",descriptionPhrase:'ä»Šå›ã¯ç‰¹ã«<span class="highlight-point">æœªçµŒé¨“</span>ã‹ã‚‰ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã§ãã‚‹ãŠä»•äº‹ã‚’ã”ç”¨æ„ã—ã¾ã—ãŸã€‚æœ€åˆã¯ç°¡å˜ãªä½œæ¥­ã‹ã‚‰ãŠä»»ã›ã—ã¾ã™ã—ã€å…ˆè¼©ã‚¹ã‚¿ãƒƒãƒ•ãŒéš£ã§ã—ã£ã‹ã‚Šã‚µãƒãƒ¼ãƒˆã™ã‚‹ã®ã§å®‰å¿ƒã§ã™ã€‚',explanation:(e,t,o)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®ã”è¦æœ›ï¼š</b> ã€Œ${t}ã€</div><div class="explanation-interpretation"><b>AIã®è§£é‡ˆï¼š</b> ãŠå®¢æ§˜ã¯ã€Œ<b>æœªçµŒé¨“è€…</b>ã€ã‚’å‹Ÿé›†ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b><br>ãŠå®¢æ§˜ã®ã”è¦æœ›ã‚’å¶ãˆã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2ç‚¹ã‚’ç››ã‚Šè¾¼ã‚“ã å°‚ç”¨åŸç¨¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><ul><li><b>â‘ ã‚¿ã‚¤ãƒˆãƒ«ï¼š</b>ã€Œ<span class="highlight-point">${o}</span>ã€ã¨ã„ã†ã€æœªçµŒé¨“è€…ãŒå®‰å¿ƒã§ãã‚‹æ–‡è¨€ã§å¿œå‹Ÿã®ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã¾ã™ã€‚</li><li><b>â‘¡æ¥­å‹™å†…å®¹ï¼š</b>ãƒ¡ã‚¤ãƒ³æ¥­å‹™ãŒã€Œ<span class="highlight-point">${e}</span>ã€ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ä¼ãˆã€ã•ã‚‰ã«ã€Œ<span class="highlight-point">æœªçµŒé¨“</span>ã€ã‚’æ­“è¿ã—ã€ã‚µãƒãƒ¼ãƒˆä½“åˆ¶ãŒã‚ã‚‹ã“ã¨ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã—ã¾ã™ã€‚</li></ul></div>`}},é•·æœŸ:{type:"positive",solution:{titlePhrase:"â­ï¸é•·æœŸã§åƒã‘ã‚‹æ–¹ã€å¤§æ­“è¿ï¼â­ï¸",descriptionPhrase:'ã¾ãŸã€<span class="highlight-point">é•·æœŸ</span>ã§åƒããŸã„ã¨ã„ã†ã”è¦æœ›ã«ãŠå¿œãˆã™ã‚‹ãŸã‚ã€è…°ã‚’æ®ãˆã¦åƒã‘ã‚‹ç’°å¢ƒã‚’æ•´ãˆã¦ã„ã¾ã™ã€‚ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚„å®‰å®šã—ãŸå‹¤å‹™ã‚’ã”å¸Œæœ›ã®æ–¹ã«æœ€é©ã§ã™ã€‚',explanation:(e,t,o)=>`<div class="explanation-problem"><b>ãŠå®¢æ§˜ã®ã”è¦æœ›ï¼š</b> ã€Œ${t}ã€</div><div class="explanation-interpretation"><b>AIã®è§£é‡ˆï¼š</b> ãŠå®¢æ§˜ã¯ã€Œ<b>é•·æœŸã§åƒã‘ã‚‹äºº</b>ã€ã‚’å‹Ÿé›†ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚</div><br><div class="explanation-solution"><b>è§£æ±ºç­–ã®ã”ææ¡ˆï¼š</b><br>ãŠå®¢æ§˜ã®ã”è¦æœ›ã‚’å¶ãˆã‚‹ãŸã‚ã€ä»¥ä¸‹ã®2ç‚¹ã‚’ç››ã‚Šè¾¼ã‚“ã å°‚ç”¨åŸç¨¿ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚</div><br><div class="explanation-point"><b>å…·ä½“çš„ãªå¤‰æ›´ç‚¹ï¼š</b><ul><li><b>â‘ ã‚¿ã‚¤ãƒˆãƒ«ï¼š</b>ã€Œ<span class="highlight-point">${o}</span>ã€ã¨ã„ã†ã‚­ãƒ£ãƒƒãƒãƒ¼ãªæ–‡è¨€ã§ã€å®‰å®šã—ã¦åƒããŸã„ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ã‚¢ãƒ”ãƒ¼ãƒ«ã—ã¾ã™ã€‚</li><li><b>â‘¡æ¥­å‹™å†…å®¹ï¼š</b>ãƒ¡ã‚¤ãƒ³æ¥­å‹™ãŒã€Œ<span class="highlight-point">${e}</span>ã€ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ä¼ãˆã€ã•ã‚‰ã«ã€Œ<span class="highlight-point">é•·æœŸ</span>ã€æ­“è¿ã®ä¸€æ–‡ã‚’è¿½åŠ ã—ã¦ã€ãƒŸã‚¹ãƒãƒƒãƒã‚’é˜²ãã¾ã™ã€‚</li></ul></div>`}}};
        let suggestions = [];
        const aiSuggestion = createHybridSuggestion(industry, workDetails, needs, intentSolutions);
        if (aiSuggestion) { suggestions.push(aiSuggestion); }
        const needsKeywords = needs.toLowerCase().replace(/ï¼ˆ/g, '(').replace(/ï¼‰/g, ')').split(/[\s,ã€]+/).filter(Boolean);
        const workDetailsKeywords = workDetails.toLowerCase().split(/[\s,ã€]+/).filter(Boolean);
        let scoredSuggestions = [];
        if (industry === 'ã‚³ãƒ³ãƒ“ãƒ‹') {
            existingTemplates.forEach(template => {
                let score = 0;
                const templateContent = [template.title.toLowerCase(), template.description.toLowerCase(), ...(template.keywords || []).map(k => k.toLowerCase())].join(' ');
                needsKeywords.forEach(keyword => { if (templateContent.includes(keyword)) score += 1; });
                workDetailsKeywords.forEach(keyword => { if (templateContent.includes(keyword)) score += 1; });
                if (needsKeywords.some(kw => templateContent.includes(kw)) && workDetailsKeywords.some(kw => templateContent.includes(kw))) { score += 5; }
                if (score > 0) {
                    const suggestion = JSON.parse(JSON.stringify(template));
                    suggestion.score = score;
                    [...needsKeywords, ...workDetailsKeywords].forEach(word => {
                        if (word) {
                            const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi");
                            suggestion.title = suggestion.title.replace(regex, `<span class="highlight-point">$&</span>`);
                            suggestion.description = suggestion.description.replace(regex, `<span class="highlight-point">$&</span>`);
                        }
                    });
                    scoredSuggestions.push(suggestion);
                }
            });
        }
        const existingTitles = new Set(suggestions.map(s => s.title));
        scoredSuggestions.forEach(s => {
            if (!existingTitles.has(s.title)) {
                suggestions.push(s);
                existingTitles.add(s.title);
            }
        });
        suggestions.sort((a, b) => (b.score || 0) - (a.score || 0));
        return suggestions.slice(0, 3);
    }
    function createHybridSuggestion(industry, workDetails, needs, intentSolutions) {
        if (!needs) return null;
        for (const keyword in intentSolutions) {
            if (needs.toLowerCase().includes(keyword)) {
                const intent = intentSolutions[keyword];
                const solution = intent.solution;
                let suggestion = JSON.parse(JSON.stringify(getBaseTemplate(industry, workDetails)));
                if (intent.type === 'negative') {
                    suggestion.concept = "AIææ¡ˆ: èª²é¡Œè§£æ±ºãƒ—ãƒ©ãƒ³";
                    suggestion.score = 1000;
                    suggestion.title = `${solution.titlePhrase} ã€${industry}ã€‘${workDetails || 'ã‚¹ã‚¿ãƒƒãƒ•'}å‹Ÿé›†`;
                    suggestion.description = `ã€ä¸»ãªæ¥­å‹™å†…å®¹ã€‘\n${workDetails ? `<span class="highlight-point">${workDetails}</span> ã‚’ãƒ¡ã‚¤ãƒ³ã¨ã—ãŸæ¥­å‹™ã‚’ãŠä»»ã›ã—ã¾ã™ã€‚` : ''}\n\n${solution.descriptionPhrase || 'çœŸé¢ç›®ã«å‹¤å‹™ã„ãŸã ã‘ã‚‹æ–¹ã€ã”å¿œå‹ŸãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼'}`;
                    if(solution.conditions){ suggestion.conditions = Array.from(new Set([...solution.conditions, ...suggestion.conditions])); }
                    if(solution.highlightConditions){ suggestion.highlightConditions = solution.highlightConditions; }
                    if(solution.benefits) { solution.benefits.forEach(benefit => { if(!suggestion.benefits.includes(benefit)){ suggestion.benefits.unshift(benefit); } }); }
                    suggestion.explanation = solution.explanation(workDetails, needs);
                } else if (intent.type === 'positive' && workDetails) {
                    suggestion.concept = "AIææ¡ˆ: æœ€é©åŒ–ãƒ—ãƒ©ãƒ³";
                    suggestion.score = 999;
                    suggestion.title = `${solution.titlePhrase} ã€${industry}ã€‘${workDetails}ã‚¹ã‚¿ãƒƒãƒ•å‹Ÿé›†`;
                    suggestion.description = `ã€ä¸»ãªæ¥­å‹™å†…å®¹ã€‘\n<span class="highlight-point">${workDetails}</span> ã‚’ãƒ¡ã‚¤ãƒ³ã¨ã—ãŸæ¥­å‹™ã‚’ãŠä»»ã›ã—ã¾ã™ã€‚\n\n${solution.descriptionPhrase}`;
                    suggestion.explanation = solution.explanation(workDetails, needs, solution.titlePhrase);
                } else { continue; }
                return suggestion;
            }
        }
        return null;
    }
    function getBaseTemplate(industry, workDetails) {
        const standardNotes = `ã€åˆæµã€‘\nãŠåº—ã«ç€ãã¾ã—ãŸã‚‰ã€ä¸€èˆ¬ã®ãŠå®¢æ§˜ã¨åŒã˜ã‚ˆã†ã«å…¥å£ã‹ã‚‰å…¥åº—ã—ã€ã€Œã‚¿ã‚¤ãƒŸãƒ¼ã‹ã‚‰åƒãã«æ¥ã¾ã—ãŸï¼ã€ã¨è¿‘ãã®åº—å“¡ã«ãŠä¼ãˆãã ã•ã„ã€‚\n\nã€é…åˆ»ã€‘\né…åˆ»ã¯å³ç¦ã§ã™ï¼ä¸‡ãŒä¸€é…ã‚Œã‚‹å ´åˆã¯ã€ç·Šæ€¥é€£çµ¡å…ˆã¸å¿…ãšãŠé›»è©±ãã ã•ã„ã€‚\n\nã€æœè£…ã€‘\nåˆ¶æœã¯å½“åº—ã§ç”¨æ„ã—ã¾ã™ã€‚\næ¸…æ½”æ„Ÿã®ã‚ã‚‹èº«ã ã—ãªã¿ã§å‹¤å‹™ã—ã¦ãã ã•ã„ã€‚\nå¥‡æŠœãªãƒã‚¤ãƒ«ã€é¦™æ°´ã¯NGã§ã™ã€‚ãƒ”ã‚¢ã‚¹ç­‰ã®è²´é‡å“ã¯æ¥­å‹™å‰ã«å¤–ã—ã¦ãã ã•ã„ã€‚`;
        let template = { industry_type: "", title: "", description: "", items: ['é»’ã®ã‚ºãƒœãƒ³ï¼ˆã‚¸ãƒ£ãƒ¼ã‚¸ãƒ»ã‚¹ã‚¦ã‚§ãƒƒãƒˆNGï¼‰', 'æ»‘ã‚Šã«ãã„é´ï¼ˆã‚µãƒ³ãƒ€ãƒ«NGï¼‰', 'ãƒœãƒ¼ãƒ«ãƒšãƒ³ãƒ»ãƒ¡ãƒ¢å¸³'], conditions: ['Goodç‡90%ä»¥ä¸Šã€ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡ãŒ10%ä»¥ä¸‹ã®æ–¹', 'æ™‚é–“ã‚’å®ˆã‚Œã‚‹æ–¹', 'ãŠåº—ã®ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã£ã¦æ¥½ã—ãåƒã‘ã‚‹æ–¹'], notes: standardNotes, benefits: ['äº¤é€šè²»æ”¯çµ¦', 'åˆ¶æœè²¸ä¸'], };
        let baseDescription = "";
        switch(industry) {
            case 'é£²é£Ÿåº—': template.industry_type = "é£²é£Ÿ / ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚¹ã‚¿ãƒƒãƒ•"; baseDescription = "ãƒ›ãƒ¼ãƒ«ã§ã®æ¥å®¢ã€ç°¡å˜ãªèª¿ç†è£œåŠ©ã€æ´—ã„å ´ãªã©ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"; template.benefits.push('ã¾ã‹ãªã„ã‚ã‚Š'); break;
            case 'ã‚³ãƒ³ãƒ“ãƒ‹': template.industry_type = "è²©å£² / ã‚³ãƒ³ãƒ“ãƒ‹ãƒ»ã‚¹ãƒ¼ãƒ‘ãƒ¼"; baseDescription = "ãƒ¬ã‚¸æ¥­å‹™ã€å“å‡ºã—ã€ç°¡å˜ãªæ¸…æƒãªã©ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"; break;
            case 'å°å£²ãƒ»è²©å£²': template.industry_type = "è²©å£² / ã‚¢ãƒ‘ãƒ¬ãƒ«ãƒ»é›‘è²¨"; baseDescription = "å•†å“ã®å“å‡ºã—ã€é™³åˆ—ã€ãƒ¬ã‚¸æ¥­å‹™ã€ãŠå®¢æ§˜å¯¾å¿œãªã©ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"; template.benefits.push('é«ªå‹ï¼ã‚«ãƒ©ãƒ¼è‡ªç”±'); break;
            case 'è»½ä½œæ¥­ãƒ»ç‰©æµ': template.industry_type = "è»½ä½œæ¥­ / å€‰åº«ãƒ»ç‰©æµ"; baseDescription = "å€‰åº«å†…ã§ã€æŒ‡ç¤ºæ›¸ã‚’è¦‹ãªãŒã‚‰å•†å“ã‚’ãƒ”ãƒƒã‚­ãƒ³ã‚°ã—ãŸã‚Šã€æ¢±åŒ…ã—ãŸã‚Šã™ã‚‹ãŠä»•äº‹ã§ã™ã€‚"; template.benefits.push('ãƒã‚¤ã‚¯ï¼è»Šé€šå‹¤å¯'); break;
            case 'ã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯': template.industry_type = "ã‚ªãƒ•ã‚£ã‚¹ãƒ¯ãƒ¼ã‚¯ / äº‹å‹™"; baseDescription = "PCã‚’ä½¿ã£ãŸãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã€æ›¸é¡ã®ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã€é›»è©±ã®å–æ¬¡ããªã©ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"; template.benefits.push('é«ªå‹ï¼ã‚«ãƒ©ãƒ¼è‡ªç”±'); break;
            case 'ã‚¤ãƒ™ãƒ³ãƒˆ': template.industry_type = "ã‚¤ãƒ™ãƒ³ãƒˆ / ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚¿ãƒƒãƒ•"; baseDescription = "ã‚¤ãƒ™ãƒ³ãƒˆä¼šå ´ã®è¨­å–¶ã€ãŠå®¢æ§˜ã®æ¡ˆå†…ã€ã‚°ãƒƒã‚ºè²©å£²ãªã©ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚"; break;
        }
        if (workDetails) { template.description = `ã€æ¥­å‹™å†…å®¹ã€‘\n${workDetails}`; } else { template.description = `ã€æ¥­å‹™å†…å®¹ã€‘\n${baseDescription}`; }
        return template;
    }


    // --- TALK SCRIPT HELPER SCRIPT ---
    function initializeTalkScriptHelper() {
        const page = document.getElementById('page-script');
        if (!page) return;

        const hearingContentEl = page.querySelector('#hearingContent');
        const generateScriptBtn = page.querySelector('#generateScript');
        const resultContainerEl = page.querySelector('#result-container');
        const loaderEl = page.querySelector('#loader');
        const scriptResultEl = page.querySelector('#scriptResult');
        const prefectureSelectEl = page.querySelector('#prefectureSelect');
        const minimumWageResultEl = page.querySelector('#minimumWageResult');
        const staffWorkTypeToggleEl = page.querySelector('#staffWorkTypeToggle');
        const overtimeRateInputEl = page.querySelector('#overtimeRate');
        const timeeWorkerHourlyWageInputEl = page.querySelector('#timeeWorkerHourlyWage');
        const currentStaffHourlyWageInputEl = page.querySelector('#currentStaffHourlyWage');
        const costComparisonResultEl = page.querySelector('#costComparisonResult');
        const serviceComparisonResultEl = page.querySelector('#serviceComparisonResult');
        const costInputs = page.querySelectorAll('.cost-input');
        const simInputs = page.querySelectorAll('.sim-input');
        const simHourlyWageInputEl = page.querySelector('#simHourlyWage');
        const simWorkHoursInputEl = page.querySelector('#simWorkHours');
        const simTransportationInputEl = page.querySelector('#simTransportation');

        const minimumWages={"åŒ—æµ·é“":1010,"é’æ£®":953,"å²©æ‰‹":952,"å®®åŸ":973,"ç§‹ç”°":951,"å±±å½¢":955,"ç¦å³¶":955,"èŒ¨åŸ":1005,"æ ƒæœ¨":1004,"ç¾¤é¦¬":985,"åŸ¼ç‰":1078,"åƒè‘‰":1076,"æ±äº¬":1163,"ç¥å¥ˆå·":1162,"æ–°æ½Ÿ":985,"å¯Œå±±":998,"çŸ³å·":984,"ç¦äº•":984,"å±±æ¢¨":988,"é•·é‡":998,"å²é˜œ":1001,"é™å²¡":1034,"æ„›çŸ¥":1077,"ä¸‰é‡":1023,"æ»‹è³€":1017,"äº¬éƒ½":1058,"å¤§é˜ª":1114,"å…µåº«":1052,"å¥ˆè‰¯":986,"å’Œæ­Œå±±":980,"é³¥å–":957,"å³¶æ ¹":962,"å²¡å±±":982,"åºƒå³¶":1020,"å±±å£":979,"å¾³å³¶":980,"é¦™å·":970,"æ„›åª›":956,"é«˜çŸ¥":952,"ç¦å²¡":992,"ä½è³€":956,"é•·å´":953,"ç†Šæœ¬":952,"å¤§åˆ†":954,"å®®å´":952,"é¹¿å…å³¶":953,"æ²–ç¸„":952};
        let staffWorkType = 'overtime';
        const formatCurrency = (value, showSymbol = true) => new Intl.NumberFormat('ja-JP', { style: showSymbol ? 'currency' : 'decimal', currency: 'JPY' }).format(Math.round(value));

        function calculateCost() {
            const staffWage = parseFloat(currentStaffHourlyWageInputEl.value) || 0;
            const overtimeRate = parseFloat(overtimeRateInputEl.value) || 0;
            const timeeWage = parseFloat(timeeWorkerHourlyWageInputEl.value) || 0;
            const timeeTransport = parseFloat(page.querySelector('#timeeWorkerTransportation').value) || 0;
            const hours = parseFloat(page.querySelector('#workHours').value) || 0;
            let staffTotalCost, staffCostDescription;
            if (staffWorkType === 'overtime') {
                const overtimeWage = staffWage * (1 + overtimeRate / 100);
                staffTotalCost = overtimeWage * hours;
                staffCostDescription = `(å‰²å¢—æ™‚çµ¦${formatCurrency(overtimeWage, false)}å†† Ã— ${hours}h)`;
            } else {
                staffTotalCost = staffWage * hours;
                staffCostDescription = `(é€šå¸¸æ™‚çµ¦${formatCurrency(staffWage, false)}å†† Ã— ${hours}h)`;
            }
            const timeePaymentToWorker = (timeeWage * hours) + timeeTransport;
            // ã‚µãƒ¼ãƒ“ã‚¹æ–™ã¯(å ±é…¬+äº¤é€šè²»)ã®30%ã§ã€ãã‚Œã«æ¶ˆè²»ç¨10%ãŒã‹ã‹ã‚‹
            const timeeServiceFee = timeePaymentToWorker * 0.30 * 1.1;
            const timeeTotalCost = timeePaymentToWorker + timeeServiceFee;

            const difference = staffTotalCost - timeeTotalCost;
            costComparisonResultEl.innerHTML = `
                <h3 class="font-bold text-lg mb-2 text-slate-800">è¨ˆç®—çµæœ</h3>
                <div class="space-y-2 text-sm text-slate-600">
                    <p><strong>æ—¢å­˜ã‚¹ã‚¿ãƒƒãƒ• (${staffWorkType === 'overtime' ? 'æ®‹æ¥­' : 'é€šå¸¸'}):</strong> ${formatCurrency(staffTotalCost)}</p>
                    <p class="text-xs pl-4 text-slate-500">${staffCostDescription}</p>
                    <p><strong>ã‚¿ã‚¤ãƒŸãƒ¼åˆ©ç”¨:</strong> ${formatCurrency(timeeTotalCost)}</p>
                    <p class="text-xs pl-4 text-slate-500">(è³ƒé‡‘${formatCurrency(timeeWage * hours, false)}å†† + äº¤é€šè²»${formatCurrency(timeeTransport, false)}å†† + æ‰‹æ•°æ–™)</p>
                    <hr class="my-2 border-slate-300">
                    <p class="font-bold ${difference >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ã‚³ã‚¹ãƒˆå·®é¡: ${difference >= 0 ? 'â–¼' : 'â–²'}${formatCurrency(Math.abs(difference))} ${difference >= 0 ? 'ã®å‰Šæ¸›' : 'ã®å¢—åŠ '}
                    </p>
                </div>
                <p class="text-xs mt-3 text-slate-500">â€»ã‚¿ã‚¤ãƒŸãƒ¼ã®æŒ¯è¾¼æ‰‹æ•°æ–™(200å††+ç¨/äºº/æœˆ)ã¯åˆ¥é€”ç™ºç”Ÿã—ã¾ã™ã€‚</p>`;
        }

        function calculateServiceComparison() {
            const wage = parseFloat(simHourlyWageInputEl.value) || 0;
            const hours = parseFloat(simWorkHoursInputEl.value) || 0;
            const transport = parseFloat(simTransportationInputEl.value) || 0;
            const workerPayment = (wage * hours) + transport;

            const services = [
                 { name: 'ã‚¿ã‚¤ãƒŸãƒ¼', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `ã‚µãƒ¼ãƒ“ã‚¹æ–™(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (ç¨è¾¼)`, `æŒ¯è¾¼æ‰‹æ•°æ–™: 220å††/äºº/æœˆ (ç¨è¾¼)`] },
                 { name: 'ã‚·ã‚§ã‚¢ãƒ•ãƒ«', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `ã‚µãƒ¼ãƒ“ã‚¹æ–™(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (ç¨è¾¼)`, `æŒ¯è¾¼æ‰‹æ•°æ–™: 220å††/å› (ç¨è¾¼)`] },
                 { name: 'ãƒ¡ãƒ«ã‚«ãƒªãƒãƒ­', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `ã‚µãƒ¼ãƒ“ã‚¹æ–™(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (ç¨è¾¼)`, `æŒ¯è¾¼æ‰‹æ•°æ–™: 220å††/å› (ç¨è¾¼)`] },
                 { name: 'ã‚¹ãƒãƒƒãƒˆãƒã‚¤ãƒˆãƒ«', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `ã‚µãƒ¼ãƒ“ã‚¹æ–™(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (ç¨è¾¼)`, `æŒ¯è¾¼æ‰‹æ•°æ–™: 220å††/äºº/æœˆ (ç¨è¾¼)`] },
                 { name: 'ã‚·ãƒ§ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹', calculate: p => p + 2750, breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `æ²è¼‰æ–™(å®šé¡): 2,750å†† (ç¨è¾¼)`] },
                 { name: 'ã‚·ãƒ§ãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹(ã‚³ãƒ³ãƒ“ãƒ‹)', calculate: p => p + 1650, breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `æ²è¼‰æ–™(å®šé¡): 1,650å†† (ç¨è¾¼)`] },
                 { name: 'ãƒãƒƒãƒãƒœãƒƒã‚¯ã‚¹', calculate: p => p + 770, breakdown: [`å ±é…¬: ${formatCurrency(workerPayment)}`, `ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨æ–™: 770å†† (ç¨è¾¼)`, `â€»åˆ¥é€” åˆæœŸ/æœˆé¡è²»ç”¨`] }
            ];
            
            serviceComparisonResultEl.innerHTML = services.map(service => {
                const totalCost = service.calculate(workerPayment);
                const isTimee = service.name === 'ã‚¿ã‚¤ãƒŸãƒ¼';
                return `
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-200 flex justify-between items-start gap-4">
                    <div class="flex-grow">
                        <p class="font-semibold ${isTimee ? 'text-sky-600' : 'text-slate-900'}">${service.name}</p>
                        <ul class="text-xs text-slate-500 list-disc list-inside mt-1 space-y-0.5">${service.breakdown.map(b => `<li>${b}</li>`).join('')}</ul>
                    </div>
                    <p class="font-bold text-lg whitespace-nowrap ${isTimee ? 'text-sky-600' : 'text-slate-800'}">${formatCurrency(totalCost)}</p>
                </div>`;
            }).join('');
        }

        function setupMinimumWageTool() {
            Object.keys(minimumWages).forEach(pref => prefectureSelectEl.add(new Option(pref, pref)));
            prefectureSelectEl.value = 'æ±äº¬';
            displayMinimumWage();
        }

        function displayMinimumWage() {
            const wage = minimumWages[prefectureSelectEl.value];
            minimumWageResultEl.innerHTML = `<span class="font-bold text-2xl text-sky-600">${formatCurrency(wage)}</span> <span class="text-sm text-slate-500">/ æ™‚é–“</span>`;
            timeeWorkerHourlyWageInputEl.value = wage;
            currentStaffHourlyWageInputEl.value = wage;
            simHourlyWageInputEl.value = wage;
            calculateCost();
            calculateServiceComparison();
        }
        
        async function generateText(prompt) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { temperature: 0.7, topK: 1, topP: 1, maxOutputTokens: 2048 }};
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API request failed: ${await response.text()}`);
            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            }
            console.error("API Error:", result);
            return "æœ‰åŠ¹ãªå¿œç­”ã‚’AIã‹ã‚‰å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
        }

        costInputs.forEach(input => input.addEventListener('input', calculateCost));
        simInputs.forEach(input => input.addEventListener('input', calculateServiceComparison));
        prefectureSelectEl.addEventListener('change', displayMinimumWage);
        
        staffWorkTypeToggleEl.addEventListener('click', (e) => {
            if (!e.target.closest('button')) return;
            const button = e.target.closest('button');
            staffWorkType = button.dataset.type;
            page.querySelectorAll('#staffWorkTypeToggle button').forEach(btn => {
                btn.classList.remove('bg-white', 'text-sky-600', 'font-semibold');
                btn.classList.add('bg-transparent', 'text-slate-500');
            });
            button.classList.add('bg-white', 'text-sky-600', 'font-semibold');
            button.classList.remove('bg-transparent', 'text-slate-500');
            overtimeRateInputEl.disabled = (staffWorkType === 'regular');
            overtimeRateInputEl.parentElement.classList.toggle('opacity-50', staffWorkType === 'regular');
            calculateCost();
        });

        generateScriptBtn.addEventListener('click', async () => {
            const hearingText = hearingContentEl.value.trim();
            if (!hearingText) { 
                // Using a custom modal instead of alert
                showModal('ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            resultContainerEl.style.display = 'block';
            scriptResultEl.style.display = 'none';
            loaderEl.style.display = 'flex';
            
            // --- UPDATED PART: Added service document context to the prompt ---
            const serviceDocumentContext = `
# ã‚¿ã‚¤ãƒŸãƒ¼ ã‚µãƒ¼ãƒ“ã‚¹æ¦‚è¦
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¢ãƒ‡ãƒ«**: ã€ŒåƒããŸã„æ™‚é–“ã€ã¨ã€Œåƒã„ã¦ã»ã—ã„æ™‚é–“ã€ã‚’ãƒãƒƒãƒãƒ³ã‚°ã™ã‚‹ã‚¹ã‚­ãƒãƒã‚¤ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã€‚æ±‚äººã‚µã‚¤ãƒˆã‚„æ´¾é£ã¨ã¯ç•°ãªã‚‹ã€‚
- **å®Ÿç¸¾**:
  - ã‚¹ã‚­ãƒãƒã‚¤ãƒˆã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨ç‡No.1ã€‚
  - å°å…¥äº‹æ¥­è€…æ•°: 159,000ç¤¾ä»¥ä¸Šã€‚
  - ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°: 1,100ä¸‡äººä»¥ä¸Šã€‚
- **å°å…¥æ¥­ç•Œ**: ç‰©æµ(42%), å°å£²(29%), é£²é£Ÿ(17%), ãƒ›ãƒ†ãƒ«(8%)ãªã©å¤šå²ã«ã‚ãŸã‚‹ã€‚
- **ãƒ¯ãƒ¼ã‚«ãƒ¼å±æ€§**: å­¦ç”Ÿ(32.6%), ä¼šç¤¾å“¡(27.6%), ãƒ‘ãƒ¼ãƒˆ/ã‚¢ãƒ«ãƒã‚¤ãƒˆ(16.8%)ãªã©ã€20ä»£ã€œ30ä»£ã‚’ä¸­å¿ƒã«å¹…åºƒã„å¹´ä»£ãŒç™»éŒ²ã€‚

# äº‹æ¥­è€…å´ã®ãƒ¡ãƒªãƒƒãƒˆ
- **å³æ™‚æ€§**: å‹Ÿé›†é–‹å§‹ã‹ã‚‰æœ€çŸ­1åˆ†ã§æ²è¼‰ã€ã™ãã«åƒãæ‰‹ãŒè¦‹ã¤ã‹ã‚‹ã€‚
- **æ¡ç”¨ã‚³ã‚¹ãƒˆ**:
  - åˆæœŸè²»ç”¨ãƒ»æœˆé¡è²»ç”¨ãƒ»æ²è¼‰è²»ç”¨ã¯ä¸€åˆ‡ç„¡æ–™ã€‚å®Œå…¨æˆæœå ±é…¬å‹ã€‚
  - æ‰‹æ•°æ–™ã¯ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å ±é…¬ï¼ˆçµ¦ä¸ï¼‹äº¤é€šè²»ï¼‰ã®30%ã€‚
  - åƒãã¶ã‚ŠãŒè‰¯ã‹ã£ãŸãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’é•·æœŸé›‡ç”¨(ã‚¢ãƒ«ãƒã‚¤ãƒˆãªã©)ã¸ç›´æ¥å¼•ãæŠœã„ã¦ã‚‚ã€ç´¹ä»‹æ–™ã¯ç„¡æ–™ã€‚
- **åŠ´å‹™ç®¡ç†ã®ç°¡ç•¥åŒ–**:
  - é›‡ç”¨å¥‘ç´„ã¯QRã‚³ãƒ¼ãƒ‰ã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆã§è‡ªå‹•ç· çµã€‚
  - çµ¦ä¸ã¯ã‚¿ã‚¤ãƒŸãƒ¼ãŒç«‹æ›¿æ‰•ã„ã—ã€äº‹æ¥­è€…ã¯æœˆæœ«ã«ä¸€æ‹¬æ”¯æ‰•ã„ã€‚
  - æºæ³‰å¾´åã‚„åŠ´åƒæ¡ä»¶é€šçŸ¥æ›¸ç™ºè¡Œãªã©ã®åŠ´å‹™ä½œæ¥­ã‚‚ã‚·ã‚¹ãƒ†ãƒ ãŒã‚µãƒãƒ¼ãƒˆã€‚
- **ãƒ¯ãƒ¼ã‚«ãƒ¼ã®è³ªã¨ä¿¡é ¼æ€§**:
  - **ãƒšãƒŠãƒ«ãƒ†ã‚£åˆ¶åº¦**: ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚„ç„¡æ–­æ¬ å‹¤ã«ã¯ãƒšãƒŠãƒ«ãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆãŒä»˜ä¸ã•ã‚Œã€åˆ©ç”¨ãŒåˆ¶é™ã•ã‚Œã‚‹ã€‚ç„¡æ–­æ¬ å‹¤ç‡ã¯0.2%ã€‚
  - **è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ **: ãƒ¯ãƒ¼ã‚«ãƒ¼ã®åƒãã¶ã‚Šã‚’è©•ä¾¡ãƒ»ç¢ºèªã§ãã‚‹ã€‚Goodç‡ã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’äº‹å‰ã«ç¢ºèªå¯èƒ½ã€‚
  - **ã‚¿ã‚¤ãƒŸãƒ¼ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ**: Goodç‡90%ä»¥ä¸Šã€ç›´å‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç‡5%æœªæº€ã®å„ªè‰¯ãƒ¯ãƒ¼ã‚«ãƒ¼ã«æ±‚äººã‚’å…ˆè¡Œå…¬é–‹ã§ãã‚‹ã€‚
  - **ãƒãƒƒã‚¸æ©Ÿèƒ½**: ç‰¹å®šã®ã‚¹ã‚­ãƒ«ï¼ˆãƒ¬ã‚¸ã€èª¿ç†ãªã©ï¼‰ã‚’æŒã¤ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ãƒãƒƒã‚¸ã‚’ä»˜ä¸ã€‚ãƒãƒƒã‚¸ä¿æœ‰è€…é™å®šã§æ±‚äººã‚’å…¬é–‹ã§ãã‚‹ãŸã‚ã€å³æˆ¦åŠ›ã‚’é›†ã‚ã‚„ã™ã„ã€‚
  - **ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼**: åƒãã«æ¥ãŸãƒ¯ãƒ¼ã‚«ãƒ¼ãŒæ°—ã«å…¥ã‚Œã°ã€ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã¨ã—ã¦åƒãç¶šã‘ã¦ã‚‚ã‚‰ã„ã‚„ã™ã„ï¼ˆæŸç¤¾ã§ã¯ãƒªãƒ”ãƒ¼ãƒˆç‡94%ï¼‰ã€‚
`;

            const fullPrompt = `ã‚ãªãŸã¯ã€Œã‚¿ã‚¤ãƒŸãƒ¼ã®æ´»ç”¨ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆã€ã®ãƒšãƒ«ã‚½ãƒŠã¨ã—ã¦ã€ã‚¿ã‚¤ãƒŸãƒ¼ã«ç™»éŒ²ã—ã¦ã„ãªã„åº—èˆ—ã¸ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã®é›»è©±å–¶æ¥­ã‚’æ”¯æ´ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ãŒå…±æœ‰ã•ã‚ŒãŸã‚‰ã€ãã‚Œã‚’åŸºã«ã€ä»¥ä¸‹ã®ã€Œã‚¿ã‚¤ãƒŸãƒ¼ã®ã‚µãƒ¼ãƒ“ã‚¹è³‡æ–™ã€ã‚’å‚è€ƒã«ã—ã¦ã€åŠ¹æœçš„ãªãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒã‚¤ãƒ³ãƒˆæ¡ˆã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€æŒ¨æ‹¶ã‚’å«ã‚€å…¨ä½“ã®æµã‚Œã§ã¯ãªãã€ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹ã«å¯¾ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆè¨´æ±‚ã«ç‰¹åŒ–ã—ãŸãƒã‚¤ãƒ³ãƒˆã«çµã£ã¦4ï½5è¡Œã§ä½œæˆã—ã¾ã™ã€‚é›»è©±ä¸­ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã€åˆ†ã‹ã‚Šã‚„ã™ã„æ§‹æˆã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤ªå­—ã«ã™ã‚‹å½¢å¼ï¼ˆä¾‹: **ãƒˆãƒ¼ã‚¯æ¡ˆâ‘ **ã€**ãƒˆãƒ¼ã‚¯æ¡ˆâ‘¡**ã€**ãƒˆãƒ¼ã‚¯æ¡ˆâ‘¢**ã€**è£œè¶³**ï¼‰ã«ã—ã¦ãã ã•ã„ã€‚\n\n---ã“ã“ã‹ã‚‰ã‚¿ã‚¤ãƒŸãƒ¼ã®ã‚µãƒ¼ãƒ“ã‚¹è³‡æ–™---\n${serviceDocumentContext}\n---ã“ã“ã¾ã§ã‚¿ã‚¤ãƒŸãƒ¼ã®ã‚µãƒ¼ãƒ“ã‚¹è³‡æ–™---\n\n---ã“ã“ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›---\n\n## ãƒ’ã‚¢ãƒªãƒ³ã‚°å†…å®¹\n${hearingText}`;

            try {
                const text = await generateText(fullPrompt);
                scriptResultEl.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>').replace(/\n/g, '<br>');
            } catch (error) {
                console.error("Error generating text:", error);
                scriptResultEl.innerHTML = `<p class="text-red-500">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>`;
            } finally {
                loaderEl.style.display = 'none';
                scriptResultEl.style.display = 'block';
            }
        });

        // Add a simple modal function to replace alert()
        function showModal(message) {
            const modalBackdrop = document.createElement('div');
            modalBackdrop.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalBackdrop.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
                    <p class="text-slate-700 mb-4">${message}</p>
                    <button class="w-full bg-sky-600 text-white font-bold py-2 px-4 rounded-md hover:bg-sky-700 transition">OK</button>
                </div>
            `;
            modalBackdrop.querySelector('button').onclick = () => {
                document.body.removeChild(modalBackdrop);
            };
            document.body.appendChild(modalBackdrop);
        }

        calculateServiceComparison();
        setupMinimumWageTool();
    }
</script>

</body>
</html>
