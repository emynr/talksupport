<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timee 営業支援統合ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* --- General Styles --- */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }

        /* --- Sidebar Styles --- */
        .sidebar {
            width: 240px; /* Reduced width */
            background-color: #1e293b; /* slate-800 */
            color: #94a3b8; /* slate-400 */
            transition: width 0.3s ease;
        }
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            color: #cbd5e1; /* slate-300 */
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        .sidebar-link:hover {
            background-color: #334155; /* slate-700 */
            color: #ffffff;
        }
        .sidebar-link.active {
            background-color: #0f172a; /* slate-900 */
            color: #ffffff;
            font-weight: 600;
            border-left-color: #38bdf8; /* sky-400 */
        }
        .sidebar-link svg {
            margin-right: 1rem;
        }
        .main-content > .page {
            display: none;
        }
        .main-content > .page.active {
            display: block;
        }

        /* --- Proposal Generator Styles --- */
        #page-generator {
             background-color: #f8fafc; /* slate-50 */
        }
        .accent-color { color: #0284c7; } /* sky-600 */
        .accent-bg { background-color: #0284c7; } /* sky-600 */
        
        .copy-btn {
            background-color: #e2e8f0; /* slate-200 */
            border: none;
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            line-height: 1;
            color: #475569; /* slate-600 */
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
        }
        .copy-btn:hover { background-color: #cbd5e1; } /* slate-300 */
        .copied-feedback { background-color: #10B981 !important; color: white !important; }
        .section-content {
            white-space: pre-wrap;
            color: #475569; /* slate-600 */
            line-height: 1.7;
            padding-left: 0.25rem;
        }
        .section-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b; /* slate-800 */
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #64748b; /* slate-500 */
            transition: all 0.2s;
            font-size: 0.875rem;
            white-space: nowrap;
        }
        .tab:hover { color: #1e293b; } /* slate-800 */
        .tab.active {
            color: #0284c7; /* sky-600 */
            border-bottom-color: #0284c7; /* sky-600 */
            font-weight: 600;
        }
        .tab-panel.hidden { display: none; }
        .highlight-point, .highlight-condition {
            background-color: #ecfeff; /* cyan-50 */
            color: #0891b2; /* cyan-600 */
            font-weight: 600;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
        }
        .explanation-box {
            background-color: #f1f5f9; /* slate-100 */
            border: 1px solid #e2e8f0; /* slate-200 */
        }
        .explanation-box b { font-weight: 600; }
        .explanation-problem b { color: #be123c; }
        .explanation-interpretation b { color: #1d4ed8; }
        .explanation-solution b { color: #059669; }

        /* --- Talk Script Helper Styles --- */
        #page-script {
             background-color: #f8fafc; /* slate-50 */
        }
        .prose strong { font-weight: 600; }
        .prose h3 { font-size: 1.125rem; font-weight: 600; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .loader { border: 4px solid #f1f5f9; border-top: 4px solid #38bdf8; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg);} }
        input:disabled, select:disabled { background-color: #e2e8f0; cursor: not-allowed; }

    </style>
</head>
<body class="bg-slate-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="sidebar flex-shrink-0 p-4">
            <div class="flex items-center mb-10 px-4">
                 <svg class="w-8 h-8 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h1 class="text-xl font-bold text-white ml-3">Sales Tool</h1>
            </div>
            <nav id="sidebar-nav" class="space-y-2">
                <a class="sidebar-link active" data-page="page-generator">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    求人原稿 提案
                </a>
                <a class="sidebar-link" data-page="page-script">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                    トークスクリプト
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content flex-1 overflow-y-auto">
            <!-- Page 1: Proposal Generator -->
            <div id="page-generator" class="page active">
                <div class="container mx-auto max-w-4xl p-8">
                    <header class="text-left mb-8">
                        <h1 class="text-3xl font-bold text-slate-800">
                            求人原稿 提案ジェネレーター
                        </h1>
                        <p class="mt-2 text-md text-slate-500">お客様のニーズに合わせた求人原稿をその場で提案します。</p>
                    </header>
                    <div class="bg-white p-6 rounded-lg border border-slate-200 mb-8">
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label for="industry" class="block text-sm font-medium text-slate-700 mb-2">1. 業種を選択</label>
                                <select id="industry" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                                    <option value="コンビニ">コンビニ</option>
                                    <option value="飲食店">飲食店</option>
                                    <option value="小売・販売">小売・販売</option>
                                    <option value="軽作業・物流">軽作業・物流</option>
                                    <option value="オフィスワーク">オフィスワーク</option>
                                    <option value="イベント">イベント</option>
                                </select>
                            </div>
                            <div>
                                <label for="work-details" class="block text-sm font-medium text-slate-700 mb-2">2. 具体的な業務内容<span class="ml-2 font-normal text-slate-500">（任意）</span></label>
                                <input type="text" id="work-details" placeholder="例：ホール、キッチン補助、品出し、清掃" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                            </div>
                            <div>
                                <label for="needs" class="block text-sm font-medium text-slate-700 mb-2">3. お客様のニーズ・課題を入力<span class="ml-2 font-normal text-slate-500">（任意）</span></label>
                                <input type="text" id="needs" placeholder="例：未経験, 経験者に来てほしい, 前回マッチングしなかった" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-md focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                            </div>
                        </div>
                        <div class="mt-6">
                            <button id="generateBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-12 rounded-md hover:bg-sky-700 transition-all transform hover:scale-[1.02] shadow-sm">
                                提案を生成する
                            </button>
                        </div>
                    </div>
                    <div id="result">
                        <div id="initial-message" class="text-center text-slate-400 py-16 px-6 bg-white rounded-lg border border-slate-200">
                            <svg class="mx-auto h-12 w-12 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.375 3.375 0 0014 18.442V19.5a.75.75 0 01-1.5 0v-1.059a3.375 3.375 0 00-1.846-3.05l-.548-.547zM12 18a5 5 0 005.3-4.48c.11-.53.19-1.07.19-1.62 0-3.036-2.464-5.5-5.5-5.5S6.5 8.884 6.5 11.9c0 .55.08 1.09.19 1.62A5 5 0 0012 18z" /></svg>
                            <h3 class="mt-4 text-lg font-medium text-slate-700">ここに提案が表示されます</h3>
                            <p class="mt-1 text-sm text-slate-500">業種などを入力してボタンを押してください。</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Talk Script Helper -->
            <div id="page-script" class="page">
                <div class="container mx-auto p-4 sm:p-6 lg:p-8">
                    <header class="text-left mb-8">
                        <h1 class="text-3xl font-bold text-slate-800">タイミー活用トークスクリプト作成支援</h1>
                        <p class="mt-2 text-md text-slate-500">店舗への電話営業をAIがサポートします</p>
                    </header>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <main class="lg:col-span-2 space-y-8">
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-xl font-bold mb-4 pb-2 border-b border-slate-200 text-slate-800">1. ヒアリング内容の入力</h2>
                                <p class="text-sm text-slate-500 mb-4">お客様からヒアリングした内容（課題、利用中のサービスなど）を具体的に入力してください。</p>
                                <textarea id="hearingContent" class="w-full h-40 p-3 border border-slate-300 rounded-md bg-slate-50 focus:ring-2 focus:ring-sky-500 focus:outline-none transition" placeholder="例：飲食店の店長。最近、週末のランチタイムに人手が足りず、既存スタッフの残業が増えて困っている。求人広告を出しても応募が来ない。シェアフルを検討したことがある。"></textarea>
                                <button id="generateScript" class="mt-4 w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-md transition-transform transform hover:scale-[1.02] shadow-sm">トークスクリプト案を作成</button>
                            </div>
                            <div id="result-container" class="bg-white p-6 rounded-lg border border-slate-200 hidden">
                                <h2 class="text-xl font-bold mb-4 pb-2 border-b border-slate-200 text-slate-800">AIによるトークスクリプト案</h2>
                                <div id="loader" class="flex justify-center items-center h-40"><div class="loader"></div></div>
                                <div id="scriptResult" class="prose max-w-none text-slate-600"></div>
                            </div>
                        </main>
                        <aside class="space-y-8">
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">2. 全国の最低賃金 (2024年度)</h2>
                                <p class="text-sm text-slate-500 mb-4">都道府県を選択すると最低賃金が表示され、下の時給に自動入力されます。</p>
                                <div>
                                    <label for="prefectureSelect" class="block text-sm font-medium text-slate-700">都道府県</label>
                                    <select id="prefectureSelect" class="mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50 focus:ring-2 focus:ring-sky-500 focus:outline-none"></select>
                                </div>
                                <div id="minimumWageResult" class="mt-4 p-4 text-center bg-slate-100 rounded-lg"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">3. スタッフ vs タイミー コスト比較</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700">既存スタッフ稼働種別</label>
                                        <div id="staffWorkTypeToggle" class="mt-1 grid grid-cols-2 gap-1 rounded-lg bg-slate-200 p-1">
                                            <button data-type="overtime" class="work-type-btn bg-white text-sky-600 rounded-md py-1.5 px-2 text-sm font-semibold transition">残業</button>
                                            <button data-type="regular" class="work-type-btn bg-transparent text-slate-500 rounded-md py-1.5 px-2 text-sm transition">通常</button>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="currentStaffHourlyWage" class="block text-sm font-medium text-slate-700">既存スタッフの時給 (円)</label>
                                        <input type="number" id="currentStaffHourlyWage" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="overtimeRate" class="block text-sm font-medium text-slate-700">残業割増率 (%)</label>
                                        <input type="number" id="overtimeRate" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50 transition" value="25">
                                    </div>
                                    <hr class="border-slate-200"/>
                                    <div>
                                        <label for="timeeWorkerHourlyWage" class="block text-sm font-medium text-slate-700">タイミーワーカーの時給 (円)</label>
                                        <input type="number" id="timeeWorkerHourlyWage" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="timeeWorkerTransportation" class="block text-sm font-medium text-slate-700">タイミーワーカーの交通費 (円)</label>
                                        <input type="number" id="timeeWorkerTransportation" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="0">
                                    </div>
                                    <hr class="border-slate-200"/>
                                    <div>
                                        <label for="workHours" class="block text-sm font-medium text-slate-700">労働時間 (時間)</label>
                                        <input type="number" id="workHours" class="cost-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="4">
                                    </div>
                                </div>
                                <div id="costComparisonResult" class="mt-6 p-4 bg-slate-100 rounded-lg"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg border border-slate-200">
                                <h2 class="text-lg font-bold mb-4 text-slate-800">4. 競合サービス料金比較</h2>
                                <p class="text-sm text-slate-500 mb-4">同じ条件で各サービスを利用した場合のコストをシミュレーションします。</p>
                                <div class="space-y-4">
                                    <div>
                                        <label for="simHourlyWage" class="block text-sm font-medium text-slate-700">時給 (円)</label>
                                        <input type="number" id="simHourlyWage" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="1163">
                                    </div>
                                    <div>
                                        <label for="simWorkHours" class="block text-sm font-medium text-slate-700">労働時間 (時間)</label>
                                        <input type="number" id="simWorkHours" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="4">
                                    </div>
                                    <div>
                                        <label for="simTransportation" class="block text-sm font-medium text-slate-700">交通費 (円)</label>
                                        <input type="number" id="simTransportation" class="sim-input mt-1 block w-full p-2 border border-slate-300 rounded-md bg-slate-50" value="0">
                                    </div>
                                </div>
                                <div id="serviceComparisonResult" class="mt-6 space-y-3"></div>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>

        </div>
    </div>


<script>
    // --- Page Switching Logic ---
    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('#sidebar-nav .sidebar-link');
        const pages = document.querySelectorAll('.main-content .page');

        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                const targetPageId = link.getAttribute('data-page');
                navLinks.forEach(nav => nav.classList.remove('active'));
                link.classList.add('active');
                pages.forEach(page => {
                    page.classList.toggle('active', page.id === targetPageId);
                });
            });
        });
        initializeProposalGenerator();
        initializeTalkScriptHelper();
    });


    // --- PROPOSAL GENERATOR SCRIPT ---
    function initializeProposalGenerator() {
        const page = document.getElementById('page-generator');
        if (!page) return;
        
        // Data source remains unchanged
        const documentTemplates1 = [{"concept":"【文書】ファミマ レジ経験者","keywords":["ファミマ","ファミリーマート","経験者","レジ"],"industry_type":"販売 / コンビニ・スーパー","title":"【ファミリーマート〇〇店】🟢ファミリーマートでのレジ経験者限定（直近3年以内）🟢レジ業務スタッフの募集！","description":"＼直近3年以内にファミリーマートでのレジ経験がある方限定！／\n\nファミリーマートでのレジ業務スタッフを募集します！\nレジ操作をメインにお任せするため、お一人でレジ対応ができる方を対象としています。\n\n郵送対応などの業務もございますので、経験を活かしてスムーズに対応できる方、大歓迎です！\n\n【業務内容】\nレジ業務（接客・精算・公共料金等の対応）\n商品の品出し・陳列\nフライヤー商品の調理・補充\n洗い物全般（トング・フライヤー備品など）\n廃棄物の回収・処理\nなど\n\n短時間でも即戦力として働ける方のご応募をお待ちしております！","items":["ボールペン・メモ帳","本人確認書類（運転免許証や保険証など）","(※外国籍の方のみ）在留カード、パスポート"],"conditions":["直近3年以内にファミリーマートでのレジ経験のある方","直前キャンセルをしない方（万が一勤務が難しくなった場合は早めにご連絡、ご相談ください）","働く前の質問に回答いただける方","添付の誓約書、就業前確認事項をご確認いただき、当日本人確認書類をお持ちいただける方","ペナルティポイントが4以下・GOOD率80%以上・直前キャンセル率が10%以下の方"],"notes":"※必ずご確認ください※\n\n【勤務当日について】\n・初回勤務時には、ご本人様確認のため、本人確認書類のご提示をお願いいたします。※当日お忘れの場合は、就業をお断りする場合がございます。\n・添付の【就業前確認事項】を事前にご確認いただき、当日ご提出ください。\n・上記ルールを遵守いただけない場合は、応募/勤務条件を満たさないため、就業をお断りいたします。その場合、当日の報酬（交通費を含む）はお支払いできませんのでご了承ください。\n\n【トラブル発生時の対応について】\n・店舗に設置された防犯カメラは、犯罪の防止ならびにお客様および従業員の安全確保を目的として撮影・録画しております。\n・犯罪その他不正行為の可能性がある場合は、監視・録画内容を確認いたします。\n・レジ現金の引き抜きや商品の持ち出しなど、故意または過失により当店が損害を被った場合、法令に基づき損害賠償を請求する場合がございます。\n\n【キャンセルについて】\n・直前のキャンセルは、店舗や他の従業員に多大な影響を与えます。\n・やむを得ず出勤できない場合は、事前に（2日前まで）ご連絡・キャンセルをお願いいたします。\n・上記理由から、確実に勤務可能な場合のみご応募ください。\n・キャンセルされた方、キャンセル率の高い方は、お断りさせていただく場合がございます。\n\n【身だしなみについて】\n・清潔感のある身だしなみで勤務してください。（ベージュのチノパン等の指定はありません）\n・ひげ、マニキュア（つけ爪）、半ズボン、スカートはご遠慮ください。\n・滑りにくい靴でお越しください。（ヒール、サンダル不可）\n・制服はお貸しいたします。\n\n【顔写真登録のお願い】\n円滑なマッチングと当日のスムーズな業務開始のため顔写真のご登録がないワーカー様につきましては、お申し込みをキャンセルさせていただく場合がございます。ご理解ご協力のほど、よろしくお願いいたします。","benefits":["交通費支給","制服貸与"]},];
        const originalTemplates = [{ "concept": "【既存】コンビニ未経験者歓迎", "keywords": ["未経験", "コンビニ", "初心者", "学生", "デビュー", "清掃"], "industry_type": "販売 / コンビニ・スーパー", "title": "🔰【未経験大歓迎】コンビニデビュー応援！簡単業務からスタート", "description": "レジ、品出し、清掃など、コンビニ業務全般をお願いします。初めての方でも、研修動画やマニュアルがしっかりしているので安心です。優しい先輩スタッフが丁寧に教えます！", "benefits": ["交通費支給", "制服貸与", "未経験者歓迎"], "items": ["動きやすい服装", "メモ帳", "ボールペン"], "conditions": ["明るく元気な挨拶ができる方", "時間を守れる方"], "notes": "お店に着きましたら、インターホンで『タイミーから来ました』とお伝えください。" }, { "concept": "【既存】コンビニ経験者限定", "keywords": ["経験者", "コンビニ", "即戦力", "ブランクOK"], "industry_type": "販売 / コンビニ・スーパー", "title": "✨【コンビニ経験者限定】スキルを活かせる！高待遇スタッフ", "description": "コンビニでの勤務経験を活かして、即戦力として活躍してください！主にお任せするのはレジ業務とお客様対応です。あなたの力を貸してください！ブランクのある方も大歓迎です。", "benefits": ["交通費支給", "制服貸与"], "items": ["黒いズボン", "スニーカー"], "conditions": ["コンビニでの勤務経験が半年以上ある方", "テキパキと動ける方"], "notes": "遅刻は厳禁です。万が一遅れる場合は、必ず緊急連絡先にお電話ください。" }];
        const documentTemplates2 = [{"concept":"【文書】ローソン レジ経験者","keywords":["ローソン","経験者","レジ","商品陳列","清掃"],"industry_type":"販売 / コンビニ・スーパー","title":"【店舗名】＊ローソン勤務経験者限定＊レジ/商品陳列のお仕事","description":"＊ローソン経験者大歓迎＊\n\n主な仕事内容としては、\n・レジ\n・商品陳列\n・店内清掃（床・トイレ清掃など）\n\n他にも下記業務をお願いすることもございます。\n・フライヤーやトイレなどの清掃業務\n・コーヒーマシンなど店内設備の清掃\n・ポスターなどの販促物設置\n\n明るい笑顔でお客様へ接しましょう！\n分からないことは周りのスタッフに聞いてくださいね！\n優しく丁寧にお教えします♪","items":["ボールペン・メモ帳","長ズボン","動きやすいスニーカー"],"conditions":["ローソンでのレジ勤務経験がある方","マッチング後メッセージより制服のサイズとコンビニ勤務歴についてご連絡ください。\n（連絡いただけない場合、マッチングをキャンセルさせていただくことがあります。）"],"notes":"【到着】\nお店に着いたら、一般のお客様と同じように店舗入口から入店し、近くの店員に「タイミーから働きに来ました」とお伝えください。\n担当者が制服への着替えなどをご案内させていただきます。\n\n【服装・髪型】\n髭はNGです。\n髪が肩につく方は一つに結んでいただきます。\nネイル、香水はお控えください。\nピアス、ネックレス、指輪やアクセサリーは出勤時に外してください。\n\n【遅刻】\n遅刻は厳禁です！遅れないようにご出勤をお願いします。\n万が一遅れる場合には、緊急連絡先にご連絡をお願いします（メッセージでは当日での対応ができないため）。","benefits":["交通費支給","制服貸与"]},];
        const existingTemplates = [...documentTemplates1, ...originalTemplates, ...documentTemplates2];

        const generateBtn = page.querySelector('#generateBtn');
        if (generateBtn) {
            generateBtn.addEventListener('click', () => {
                const industry = page.querySelector('#industry').value;
                const workDetails = page.querySelector('#work-details').value.trim();
                const needs = page.querySelector('#needs').value.trim();
                const resultDiv = page.querySelector('#result');
                const initialMessage = page.querySelector('#initial-message');

                resultDiv.innerHTML = '';
                if (initialMessage) initialMessage.style.display = 'none';

                if (!needs && !workDetails) {
                    resultDiv.innerHTML = createAlertHTML('入力エラー', '「お客様のニーズ・課題」または「具体的な業務内容」のいずれかを入力してください。');
                    return;
                }

                const suggestions = generateSuggestions(industry, needs, workDetails, existingTemplates);

                if (suggestions.length === 0) {
                    resultDiv.innerHTML = createAlertHTML('提案が見つかりません', 'キーワードを変えるか、業種を変えて再度お試しください。', 'info');
                    return;
                }

                let tabsHtml = '<div class="flex border-b border-slate-200 bg-white rounded-t-lg overflow-x-auto">';
                let panelsHtml = '<div>';

                suggestions.forEach((s, index) => {
                    const isActive = index === 0;
                    const tabTitle = s.concept.replace(/【.*?】|AI提案:\s*/g, '').trim();
                    let tabLabel = `提案${index + 1}`;
                    if(s.concept.startsWith('AI提案: 課題解決プラン')) {
                        tabLabel = '⭐️課題解決提案';
                    } else if (s.concept.startsWith('AI提案: 最適化プラン')) {
                        tabLabel = '⭐️最適化提案';
                    }
                    tabsHtml += `<button class="tab ${isActive ? 'active' : ''}" data-tab-target="#panel-${index}">${tabLabel}${!tabLabel.startsWith('⭐️') ? `: ${tabTitle}` : ''}</button>`;
                    panelsHtml += `<div id="panel-${index}" class="tab-panel ${!isActive ? 'hidden' : ''}">${createSuggestionCard(s, index)}</div>`;
                });

                tabsHtml += '</div>';
                panelsHtml += '</div>';
                resultDiv.innerHTML = tabsHtml + panelsHtml;

                attachCopyListeners();
                attachTabListeners();
            });
        }
    }
    function createSuggestionCard(s, index) {
        const today = new Date();
        const formattedDate = `${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日(${['日','月','火','水','木','金','土'][today.getDay()]})`;
        let formattedConditions = Array.isArray(s.conditions) ? s.conditions.join('\n') : s.conditions;
        if (s.highlightConditions) {
            s.highlightConditions.forEach(cond => {
                const regex = new RegExp(cond.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "g");
                formattedConditions = formattedConditions.replace(regex, `<span class="highlight-condition">$&</span>`);
            });
        }
        formattedConditions = '・' + formattedConditions.replace(/\n/g, '\n・');
        return `
        <div class="bg-white rounded-b-lg shadow-sm border-l border-r border-b border-slate-200 overflow-hidden">
            <div class="h-32 bg-slate-200 flex items-center justify-center"><p class="text-slate-500">店舗ヘッダー画像 (例)</p></div>
            <div class="p-6 md:p-8">
                <p class="text-xs text-slate-500 mb-2">${s.industry_type}</p>
                <h2 id="title-content-${index}" class="text-xl font-bold text-slate-800 leading-tight">${s.title}</h2>
                <button class="copy-btn" data-clipboard-target-id="title-content-${index}">コピー</button>
                <div class="text-sm text-slate-700 mt-3"><p>🕒 ${formattedDate} 18:00 ~ 22:00 (休憩なし)</p></div>
                <div class="flex justify-between items-center mt-4 text-sm">
                    <p class="text-slate-500">あと5時間で募集締め切り</p>
                    <p class="bg-red-100 text-red-700 font-bold py-1 px-3 rounded-md">募集人数 1/2人</p>
                </div>
                <hr class="my-6 border-slate-200"><div class="text-2xl font-bold text-slate-800">¥5,200</div>
                <p class="text-xs text-slate-500">時給 ¥1,300</p>
                <p class="text-xs text-slate-500">交通費 ¥700 含む</p>
                <hr class="my-6 border-slate-200">
                <div class="space-y-8">
                    ${createSection('待遇', `benefits-content-${index}`, createBenefitsContent(s.benefits))}
                    ${createSection('業務内容', `description-content-${index}`, s.description)}
                    ${createSection('持ち物', `items-content-${index}`, Array.isArray(s.items) ? '・' + s.items.join('\n・') : s.items)}
                    ${createSection('働くための条件', `conditions-content-${index}`, formattedConditions)}
                    ${createSection('注意事項', `notes-content-${index}`, s.notes)}
                </div>
                <div id="explanation-box-${index}" class="explanation-box mt-8 p-4 rounded-lg">
                    <h4 class="font-bold text-slate-800 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-sky-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                        <span>この提案のポイント解説</span>
                    </h4>
                    <div class="text-sm text-slate-700 mt-2 leading-relaxed" id="explanation-content-${index}">${s.explanation || 'このテンプレートは入力されたキーワードとの関連性が高いため提案します。'}</div>
                </div>
            </div>
        </div>`;
    }
    function createSection(label, id, content) { return `<div><h3 class="section-header">${label}<button class="copy-btn" data-clipboard-target-id="${id}">コピー</button></h3><div class="section-content" id="${id}">${content}</div></div>`; }
    function createBenefitsContent(benefits) { const iconMap = {'交通費支給': '🚆','まかないあり': '🍜','未経験者歓迎': '🔰','制服貸与': '👕','髪型／カラー自由': '🎨','バイク／車通勤可': '🚗'}; return Array.isArray(benefits) ? benefits.map(b => `<p class="flex items-center">${iconMap[b] || '✅'} <span class="ml-2">${b}</span></p>`).join('') : ''; }
    function createAlertHTML(title, message, type = 'error') { const colors = { error: { bg: 'bg-rose-100', border: 'border-rose-500', text: 'text-rose-700' }, info: { bg: 'bg-sky-100', border: 'border-sky-500', text: 'text-sky-700' } }; return `<div class="${colors[type].bg} border-l-4 ${colors[type].border} ${colors[type].text} p-4 rounded-lg" role="alert"><p><strong>${title}</strong>: ${message}</p></div>`; }
    function attachCopyListeners() { document.querySelectorAll('.copy-btn').forEach(button => { button.addEventListener('click', (e) => { e.stopPropagation(); const targetId = button.getAttribute('data-clipboard-target-id'); const contentEl = document.getElementById(targetId); if (!contentEl) return; const tempEl = contentEl.cloneNode(true); tempEl.querySelectorAll('.highlight-point, .highlight-condition').forEach(el => { el.outerHTML = el.innerHTML; }); const content = tempEl.innerText; const textArea = document.createElement('textarea'); textArea.value = content; textArea.style.position = 'fixed'; textArea.style.top = '-9999px'; document.body.appendChild(textArea); textArea.select(); try { document.execCommand('copy'); button.innerHTML = 'コピー完了!'; button.classList.add('copied-feedback'); setTimeout(() => { button.innerHTML = 'コピー'; button.classList.remove('copied-feedback'); }, 1500); } catch (err) { console.error('コピーに失敗しました: ', err); } finally { document.body.removeChild(textArea); } }); }); }
    function attachTabListeners() { const page = document.getElementById('page-generator'); if (!page) return; const tabs = page.querySelectorAll('.tab'); const panels = page.querySelectorAll('.tab-panel'); tabs.forEach(tab => { tab.addEventListener('click', () => { tabs.forEach(t => t.classList.remove('active')); tab.classList.add('active'); const target = page.querySelector(tab.dataset.tabTarget); panels.forEach(p => p.classList.add('hidden')); if (target) target.classList.remove('hidden'); }); }); }
    function generateSuggestions(industry, needs, workDetails, existingTemplates) {
        const intentSolutions={"マッチング":{type:"negative",solution:{titlePhrase:"🔰未経験者さん大歓迎！🔰",descriptionPhrase:"特別なスキルは不要！簡単な作業から丁寧にお教えしますので、安心してご応募ください。",conditions:["Good率85%以上の方","時間を守れる方","お店のルールを守って楽しく働ける方"],highlightConditions:["Good率85%以上の方"],benefits:["未経験者歓迎"],explanation:(e,t)=>`<div class="explanation-problem"><b>お客様の課題：</b> 「${t}」</div><div class="explanation-interpretation"><b>AIの解釈：</b> 応募が集まらず、人手が確保できなかった可能性があります。</div><br><div class="explanation-solution"><b>解決策のご提案：</b> より多くのワーカー様に応募してもらえるよう、応募のハードルを少し下げつつ、仕事の魅力をアピールする原稿に変更しましょう。</div><br><div class="explanation-point"><b>具体的な変更点：</b><ul><li><b>①タイトル：</b>「<span class="highlight-point">🔰未経験者さん大歓迎！🔰</span>」のように、応募のしやすさをアピールします。</li><li><b>②業務内容：</b>「<span class="highlight-point">簡単な作業から丁寧にお教えします</span>」という一文で、初めての方の不安を払拭します。</li><li><b>③働くための条件：</b>応募の母数を増やすため、「Good率90%以上」から「<span class="highlight-condition">Good率85%以上の方</span>」へと基準を少し緩和します。一方で、直前キャンセル率の基準は維持することで、勤務態度の信頼性は担保します。</li></ul></div>`}},"直前キャンセル":{type:"negative",solution:{titlePhrase:"✨人気のお仕事！ご応募はお早めに✨",conditions:["直前キャンセル率が5%以下の方","Good率95%以上の方"],highlightConditions:["直前キャンセル率が5%以下の方","Good率95%以上の方"],explanation:(e,t)=>`<div class="explanation-problem"><b>お客様の課題：</b> 「${t}」</div><br><div class="explanation-solution"><b>解決策のご提案：</b> タイトルで直接的に警告するより、応募条件を少し厳しくして、信頼できるワーカー様から応募を集める方が効果的です。</div><br><div class="explanation-point"><b>具体的な変更点：</b><br>「働くための条件」に以下の2点を追加・変更することを提案します。<br><ul><li>・<span class="highlight-condition">直前キャンセル率が5%以下の方</span></li><li>・<span class="highlight-condition">Good率95%以上の方</span></li></ul>これにより、勤務態度が良好なワーカー様からの応募に繋がりやすくなり、結果的に直前のキャンセル防止に繋がります。</div>`}},ばっくれ:{type:"negative",solution:{titlePhrase:"✨人気のお仕事！ご応募はお早めに✨",conditions:["直前キャンセル率が5%以下の方","Good率95%以上の方"],highlightConditions:["直前キャンセル率が5%以下の方","Good率95%以上の方"],explanation:(e,t)=>`<div class="explanation-problem"><b>お客様の課題：</b> 「${t}」</div><br><div class="explanation-solution"><b>解決策のご提案：</b> タイトルで直接的に警告するより、応募条件を少し厳しくして、信頼できるワーカー様から応募を集める方が効果的です。</div><br><div class="explanation-point"><b>具体的な変更点：</b><br>「働くための条件」に以下の2点を追加・変更することを提案します。<br><ul><li>・<span class="highlight-condition">直前キャンセル率が5%以下の方</span></li><li>・<span class="highlight-condition">Good率95%以上の方</span></li></ul>これにより、勤務態度が良好なワーカー様からの応募に繋がりやすくなり、結果的に無断欠勤の防止に繋がります。</div>`}},経験者:{type:"positive",solution:{titlePhrase:"✨経験者、大歓迎！スキルを活かせるお仕事✨",descriptionPhrase:'今回は特に<span class="highlight-point">経験者</span>の方を歓迎しています。あなたのスキルや経験をぜひ当店で活かしてください。',explanation:(e,t,o)=>`<div class="explanation-problem"><b>お客様のご要望：</b> 「${t}」</div><div class="explanation-interpretation"><b>AIの解釈：</b> お客様は「<b>経験者</b>」を募集したいと考えています。</div><br><div class="explanation-solution"><b>解決策のご提案：</b><br>お客様のご要望を叶えるため、以下の2点を盛り込んだ専用原稿を生成しました。</div><br><div class="explanation-point"><b>具体的な変更点：</b><ul><li><b>①タイトル：</b>「<span class="highlight-point">${o}</span>」というキャッチーな文言で、経験者の応募を促します。</li><li><b>②業務内容：</b>メイン業務が「<span class="highlight-point">${e}</span>」であることを明確に伝え、さらに「<span class="highlight-point">経験者</span>」を歓迎する一文を追加して、ミスマッチを防ぎます。</li></ul></div>`}},未経験:{type:"positive",solution:{titlePhrase:"🔰未経験でも安心！カンタン作業からスタート🔰",descriptionPhrase:'今回は特に<span class="highlight-point">未経験</span>からチャレンジできるお仕事をご用意しました。最初は簡単な作業からお任せしますし、先輩スタッフが隣でしっかりサポートするので安心です。',explanation:(e,t,o)=>`<div class="explanation-problem"><b>お客様のご要望：</b> 「${t}」</div><div class="explanation-interpretation"><b>AIの解釈：</b> お客様は「<b>未経験者</b>」を募集したいと考えています。</div><br><div class="explanation-solution"><b>解決策のご提案：</b><br>お客様のご要望を叶えるため、以下の2点を盛り込んだ専用原稿を生成しました。</div><br><div class="explanation-point"><b>具体的な変更点：</b><ul><li><b>①タイトル：</b>「<span class="highlight-point">${o}</span>」という、未経験者が安心できる文言で応募のハードルを下げます。</li><li><b>②業務内容：</b>メイン業務が「<span class="highlight-point">${e}</span>」であることを明確に伝え、さらに「<span class="highlight-point">未経験</span>」を歓迎し、サポート体制があることをアピールします。</li></ul></div>`}},長期:{type:"positive",solution:{titlePhrase:"⭐️長期で働ける方、大歓迎！⭐️",descriptionPhrase:'また、<span class="highlight-point">長期</span>で働きたいというご要望にお応えするため、腰を据えて働ける環境を整えています。スキルアップや安定した勤務をご希望の方に最適です。',explanation:(e,t,o)=>`<div class="explanation-problem"><b>お客様のご要望：</b> 「${t}」</div><div class="explanation-interpretation"><b>AIの解釈：</b> お客様は「<b>長期で働ける人</b>」を募集したいと考えています。</div><br><div class="explanation-solution"><b>解決策のご提案：</b><br>お客様のご要望を叶えるため、以下の2点を盛り込んだ専用原稿を生成しました。</div><br><div class="explanation-point"><b>具体的な変更点：</b><ul><li><b>①タイトル：</b>「<span class="highlight-point">${o}</span>」というキャッチーな文言で、安定して働きたいワーカーにアピールします。</li><li><b>②業務内容：</b>メイン業務が「<span class="highlight-point">${e}</span>」であることを明確に伝え、さらに「<span class="highlight-point">長期</span>」歓迎の一文を追加して、ミスマッチを防ぎます。</li></ul></div>`}}};
        let suggestions = [];
        const aiSuggestion = createHybridSuggestion(industry, workDetails, needs, intentSolutions);
        if (aiSuggestion) { suggestions.push(aiSuggestion); }
        const needsKeywords = needs.toLowerCase().replace(/（/g, '(').replace(/）/g, ')').split(/[\s,、]+/).filter(Boolean);
        const workDetailsKeywords = workDetails.toLowerCase().split(/[\s,、]+/).filter(Boolean);
        let scoredSuggestions = [];
        if (industry === 'コンビニ') {
            existingTemplates.forEach(template => {
                let score = 0;
                const templateContent = [template.title.toLowerCase(), template.description.toLowerCase(), ...(template.keywords || []).map(k => k.toLowerCase())].join(' ');
                needsKeywords.forEach(keyword => { if (templateContent.includes(keyword)) score += 1; });
                workDetailsKeywords.forEach(keyword => { if (templateContent.includes(keyword)) score += 1; });
                if (needsKeywords.some(kw => templateContent.includes(kw)) && workDetailsKeywords.some(kw => templateContent.includes(kw))) { score += 5; }
                if (score > 0) {
                    const suggestion = JSON.parse(JSON.stringify(template));
                    suggestion.score = score;
                    [...needsKeywords, ...workDetailsKeywords].forEach(word => {
                        if (word) {
                            const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), "gi");
                            suggestion.title = suggestion.title.replace(regex, `<span class="highlight-point">$&</span>`);
                            suggestion.description = suggestion.description.replace(regex, `<span class="highlight-point">$&</span>`);
                        }
                    });
                    scoredSuggestions.push(suggestion);
                }
            });
        }
        const existingTitles = new Set(suggestions.map(s => s.title));
        scoredSuggestions.forEach(s => {
            if (!existingTitles.has(s.title)) {
                suggestions.push(s);
                existingTitles.add(s.title);
            }
        });
        suggestions.sort((a, b) => (b.score || 0) - (a.score || 0));
        return suggestions.slice(0, 3);
    }
    function createHybridSuggestion(industry, workDetails, needs, intentSolutions) {
        if (!needs) return null;
        for (const keyword in intentSolutions) {
            if (needs.toLowerCase().includes(keyword)) {
                const intent = intentSolutions[keyword];
                const solution = intent.solution;
                let suggestion = JSON.parse(JSON.stringify(getBaseTemplate(industry, workDetails)));
                if (intent.type === 'negative') {
                    suggestion.concept = "AI提案: 課題解決プラン";
                    suggestion.score = 1000;
                    suggestion.title = `${solution.titlePhrase} 【${industry}】${workDetails || 'スタッフ'}募集`;
                    suggestion.description = `【主な業務内容】\n${workDetails ? `<span class="highlight-point">${workDetails}</span> をメインとした業務をお任せします。` : ''}\n\n${solution.descriptionPhrase || '真面目に勤務いただける方、ご応募お待ちしております！'}`;
                    if(solution.conditions){ suggestion.conditions = Array.from(new Set([...solution.conditions, ...suggestion.conditions])); }
                    if(solution.highlightConditions){ suggestion.highlightConditions = solution.highlightConditions; }
                    if(solution.benefits) { solution.benefits.forEach(benefit => { if(!suggestion.benefits.includes(benefit)){ suggestion.benefits.unshift(benefit); } }); }
                    suggestion.explanation = solution.explanation(workDetails, needs);
                } else if (intent.type === 'positive' && workDetails) {
                    suggestion.concept = "AI提案: 最適化プラン";
                    suggestion.score = 999;
                    suggestion.title = `${solution.titlePhrase} 【${industry}】${workDetails}スタッフ募集`;
                    suggestion.description = `【主な業務内容】\n<span class="highlight-point">${workDetails}</span> をメインとした業務をお任せします。\n\n${solution.descriptionPhrase}`;
                    suggestion.explanation = solution.explanation(workDetails, needs, solution.titlePhrase);
                } else { continue; }
                return suggestion;
            }
        }
        return null;
    }
    function getBaseTemplate(industry, workDetails) {
        const standardNotes = `【合流】\nお店に着きましたら、一般のお客様と同じように入口から入店し、「タイミーから働きに来ました！」と近くの店員にお伝えください。\n\n【遅刻】\n遅刻は厳禁です！万が一遅れる場合は、緊急連絡先へ必ずお電話ください。\n\n【服装】\n制服は当店で用意します。\n清潔感のある身だしなみで勤務してください。\n奇抜なネイル、香水はNGです。ピアス等の貴重品は業務前に外してください。`;
        let template = { industry_type: "", title: "", description: "", items: ['黒のズボン（ジャージ・スウェットNG）', '滑りにくい靴（サンダルNG）', 'ボールペン・メモ帳'], conditions: ['Good率90%以上、直前キャンセル率が10%以下の方', '時間を守れる方', 'お店のルールを守って楽しく働ける方'], notes: standardNotes, benefits: ['交通費支給', '制服貸与'], };
        let baseDescription = "";
        switch(industry) {
            case '飲食店': template.industry_type = "飲食 / レストランスタッフ"; baseDescription = "ホールでの接客、簡単な調理補助、洗い場などをお願いします。"; template.benefits.push('まかないあり'); break;
            case 'コンビニ': template.industry_type = "販売 / コンビニ・スーパー"; baseDescription = "レジ業務、品出し、簡単な清掃などをお願いします。"; break;
            case '小売・販売': template.industry_type = "販売 / アパレル・雑貨"; baseDescription = "商品の品出し、陳列、レジ業務、お客様対応などをお願いします。"; template.benefits.push('髪型／カラー自由'); break;
            case '軽作業・物流': template.industry_type = "軽作業 / 倉庫・物流"; baseDescription = "倉庫内で、指示書を見ながら商品をピッキングしたり、梱包したりするお仕事です。"; template.benefits.push('バイク／車通勤可'); break;
            case 'オフィスワーク': template.industry_type = "オフィスワーク / 事務"; baseDescription = "PCを使ったデータ入力、書類のファイリング、電話の取次ぎなどをお願いします。"; template.benefits.push('髪型／カラー自由'); break;
            case 'イベント': template.industry_type = "イベント / イベントスタッフ"; baseDescription = "イベント会場の設営、お客様の案内、グッズ販売などをお願いします。"; break;
        }
        if (workDetails) { template.description = `【業務内容】\n${workDetails}`; } else { template.description = `【業務内容】\n${baseDescription}`; }
        return template;
    }


    // --- TALK SCRIPT HELPER SCRIPT ---
    function initializeTalkScriptHelper() {
        const page = document.getElementById('page-script');
        if (!page) return;

        const hearingContentEl = page.querySelector('#hearingContent');
        const generateScriptBtn = page.querySelector('#generateScript');
        const resultContainerEl = page.querySelector('#result-container');
        const loaderEl = page.querySelector('#loader');
        const scriptResultEl = page.querySelector('#scriptResult');
        const prefectureSelectEl = page.querySelector('#prefectureSelect');
        const minimumWageResultEl = page.querySelector('#minimumWageResult');
        const staffWorkTypeToggleEl = page.querySelector('#staffWorkTypeToggle');
        const overtimeRateInputEl = page.querySelector('#overtimeRate');
        const timeeWorkerHourlyWageInputEl = page.querySelector('#timeeWorkerHourlyWage');
        const currentStaffHourlyWageInputEl = page.querySelector('#currentStaffHourlyWage');
        const costComparisonResultEl = page.querySelector('#costComparisonResult');
        const serviceComparisonResultEl = page.querySelector('#serviceComparisonResult');
        const costInputs = page.querySelectorAll('.cost-input');
        const simInputs = page.querySelectorAll('.sim-input');
        const simHourlyWageInputEl = page.querySelector('#simHourlyWage');
        const simWorkHoursInputEl = page.querySelector('#simWorkHours');
        const simTransportationInputEl = page.querySelector('#simTransportation');

        const minimumWages={"北海道":1010,"青森":953,"岩手":952,"宮城":973,"秋田":951,"山形":955,"福島":955,"茨城":1005,"栃木":1004,"群馬":985,"埼玉":1078,"千葉":1076,"東京":1163,"神奈川":1162,"新潟":985,"富山":998,"石川":984,"福井":984,"山梨":988,"長野":998,"岐阜":1001,"静岡":1034,"愛知":1077,"三重":1023,"滋賀":1017,"京都":1058,"大阪":1114,"兵庫":1052,"奈良":986,"和歌山":980,"鳥取":957,"島根":962,"岡山":982,"広島":1020,"山口":979,"徳島":980,"香川":970,"愛媛":956,"高知":952,"福岡":992,"佐賀":956,"長崎":953,"熊本":952,"大分":954,"宮崎":952,"鹿児島":953,"沖縄":952};
        let staffWorkType = 'overtime';
        const formatCurrency = (value, showSymbol = true) => new Intl.NumberFormat('ja-JP', { style: showSymbol ? 'currency' : 'decimal', currency: 'JPY' }).format(Math.round(value));

        function calculateCost() {
            const staffWage = parseFloat(currentStaffHourlyWageInputEl.value) || 0;
            const overtimeRate = parseFloat(overtimeRateInputEl.value) || 0;
            const timeeWage = parseFloat(timeeWorkerHourlyWageInputEl.value) || 0;
            const timeeTransport = parseFloat(page.querySelector('#timeeWorkerTransportation').value) || 0;
            const hours = parseFloat(page.querySelector('#workHours').value) || 0;
            let staffTotalCost, staffCostDescription;
            if (staffWorkType === 'overtime') {
                const overtimeWage = staffWage * (1 + overtimeRate / 100);
                staffTotalCost = overtimeWage * hours;
                staffCostDescription = `(割増時給${formatCurrency(overtimeWage, false)}円 × ${hours}h)`;
            } else {
                staffTotalCost = staffWage * hours;
                staffCostDescription = `(通常時給${formatCurrency(staffWage, false)}円 × ${hours}h)`;
            }
            const timeePaymentToWorker = (timeeWage * hours) + timeeTransport;
            // サービス料は(報酬+交通費)の30%で、それに消費税10%がかかる
            const timeeServiceFee = timeePaymentToWorker * 0.30 * 1.1;
            const timeeTotalCost = timeePaymentToWorker + timeeServiceFee;

            const difference = staffTotalCost - timeeTotalCost;
            costComparisonResultEl.innerHTML = `
                <h3 class="font-bold text-lg mb-2 text-slate-800">計算結果</h3>
                <div class="space-y-2 text-sm text-slate-600">
                    <p><strong>既存スタッフ (${staffWorkType === 'overtime' ? '残業' : '通常'}):</strong> ${formatCurrency(staffTotalCost)}</p>
                    <p class="text-xs pl-4 text-slate-500">${staffCostDescription}</p>
                    <p><strong>タイミー利用:</strong> ${formatCurrency(timeeTotalCost)}</p>
                    <p class="text-xs pl-4 text-slate-500">(賃金${formatCurrency(timeeWage * hours, false)}円 + 交通費${formatCurrency(timeeTransport, false)}円 + 手数料)</p>
                    <hr class="my-2 border-slate-300">
                    <p class="font-bold ${difference >= 0 ? 'text-green-600' : 'text-red-600'}">
                        コスト差額: ${difference >= 0 ? '▼' : '▲'}${formatCurrency(Math.abs(difference))} ${difference >= 0 ? 'の削減' : 'の増加'}
                    </p>
                </div>
                <p class="text-xs mt-3 text-slate-500">※タイミーの振込手数料(200円+税/人/月)は別途発生します。</p>`;
        }

        function calculateServiceComparison() {
            const wage = parseFloat(simHourlyWageInputEl.value) || 0;
            const hours = parseFloat(simWorkHoursInputEl.value) || 0;
            const transport = parseFloat(simTransportationInputEl.value) || 0;
            const workerPayment = (wage * hours) + transport;

            const services = [
                 { name: 'タイミー', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `サービス料(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (税込)`, `振込手数料: 220円/人/月 (税込)`] },
                 { name: 'シェアフル', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `サービス料(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (税込)`, `振込手数料: 220円/回 (税込)`] },
                 { name: 'メルカリハロ', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `サービス料(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (税込)`, `振込手数料: 220円/回 (税込)`] },
                 { name: 'スポットバイトル', calculate: p => p + (p * 0.30 * 1.1), breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `サービス料(30%): ${formatCurrency(workerPayment * 0.30 * 1.1)} (税込)`, `振込手数料: 220円/人/月 (税込)`] },
                 { name: 'ショットワークス', calculate: p => p + 2750, breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `掲載料(定額): 2,750円 (税込)`] },
                 { name: 'ショットワークス(コンビニ)', calculate: p => p + 1650, breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `掲載料(定額): 1,650円 (税込)`] },
                 { name: 'マッチボックス', calculate: p => p + 770, breakdown: [`報酬: ${formatCurrency(workerPayment)}`, `システム利用料: 770円 (税込)`, `※別途 初期/月額費用`] }
            ];
            
            serviceComparisonResultEl.innerHTML = services.map(service => {
                const totalCost = service.calculate(workerPayment);
                const isTimee = service.name === 'タイミー';
                return `
                <div class="p-4 bg-slate-50 rounded-lg border border-slate-200 flex justify-between items-start gap-4">
                    <div class="flex-grow">
                        <p class="font-semibold ${isTimee ? 'text-sky-600' : 'text-slate-900'}">${service.name}</p>
                        <ul class="text-xs text-slate-500 list-disc list-inside mt-1 space-y-0.5">${service.breakdown.map(b => `<li>${b}</li>`).join('')}</ul>
                    </div>
                    <p class="font-bold text-lg whitespace-nowrap ${isTimee ? 'text-sky-600' : 'text-slate-800'}">${formatCurrency(totalCost)}</p>
                </div>`;
            }).join('');
        }

        function setupMinimumWageTool() {
            Object.keys(minimumWages).forEach(pref => prefectureSelectEl.add(new Option(pref, pref)));
            prefectureSelectEl.value = '東京';
            displayMinimumWage();
        }

        function displayMinimumWage() {
            const wage = minimumWages[prefectureSelectEl.value];
            minimumWageResultEl.innerHTML = `<span class="font-bold text-2xl text-sky-600">${formatCurrency(wage)}</span> <span class="text-sm text-slate-500">/ 時間</span>`;
            timeeWorkerHourlyWageInputEl.value = wage;
            currentStaffHourlyWageInputEl.value = wage;
            simHourlyWageInputEl.value = wage;
            calculateCost();
            calculateServiceComparison();
        }
        
        async function generateText(prompt) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }], generationConfig: { temperature: 0.7, topK: 1, topP: 1, maxOutputTokens: 2048 }};
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API request failed: ${await response.text()}`);
            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            }
            console.error("API Error:", result);
            return "有効な応答をAIから取得できませんでした。";
        }

        costInputs.forEach(input => input.addEventListener('input', calculateCost));
        simInputs.forEach(input => input.addEventListener('input', calculateServiceComparison));
        prefectureSelectEl.addEventListener('change', displayMinimumWage);
        
        staffWorkTypeToggleEl.addEventListener('click', (e) => {
            if (!e.target.closest('button')) return;
            const button = e.target.closest('button');
            staffWorkType = button.dataset.type;
            page.querySelectorAll('#staffWorkTypeToggle button').forEach(btn => {
                btn.classList.remove('bg-white', 'text-sky-600', 'font-semibold');
                btn.classList.add('bg-transparent', 'text-slate-500');
            });
            button.classList.add('bg-white', 'text-sky-600', 'font-semibold');
            button.classList.remove('bg-transparent', 'text-slate-500');
            overtimeRateInputEl.disabled = (staffWorkType === 'regular');
            overtimeRateInputEl.parentElement.classList.toggle('opacity-50', staffWorkType === 'regular');
            calculateCost();
        });

        generateScriptBtn.addEventListener('click', async () => {
            const hearingText = hearingContentEl.value.trim();
            if (!hearingText) { 
                // Using a custom modal instead of alert
                showModal('ヒアリング内容を入力してください。');
                return;
            }
            resultContainerEl.style.display = 'block';
            scriptResultEl.style.display = 'none';
            loaderEl.style.display = 'flex';
            
            // --- UPDATED PART: Added service document context to the prompt ---
            const serviceDocumentContext = `
# タイミー サービス概要
- **サービスモデル**: 「働きたい時間」と「働いてほしい時間」をマッチングするスキマバイトサービス。求人サイトや派遣とは異なる。
- **実績**:
  - スキマバイトサービス利用率No.1。
  - 導入事業者数: 159,000社以上。
  - ワーカー数: 1,100万人以上。
- **導入業界**: 物流(42%), 小売(29%), 飲食(17%), ホテル(8%)など多岐にわたる。
- **ワーカー属性**: 学生(32.6%), 会社員(27.6%), パート/アルバイト(16.8%)など、20代〜30代を中心に幅広い年代が登録。

# 事業者側のメリット
- **即時性**: 募集開始から最短1分で掲載、すぐに働き手が見つかる。
- **採用コスト**:
  - 初期費用・月額費用・掲載費用は一切無料。完全成果報酬型。
  - 手数料は、ワーカーの報酬（給与＋交通費）の30%。
  - 働きぶりが良かったワーカーを長期雇用(アルバイトなど)へ直接引き抜いても、紹介料は無料。
- **労務管理の簡略化**:
  - 雇用契約はQRコードのチェックイン/アウトで自動締結。
  - 給与はタイミーが立替払いし、事業者は月末に一括支払い。
  - 源泉徴収や労働条件通知書発行などの労務作業もシステムがサポート。
- **ワーカーの質と信頼性**:
  - **ペナルティ制度**: 直前キャンセルや無断欠勤にはペナルティポイントが付与され、利用が制限される。無断欠勤率は0.2%。
  - **評価システム**: ワーカーの働きぶりを評価・確認できる。Good率やレビューを事前に確認可能。
  - **タイミーエキスパート**: Good率90%以上、直前キャンセル率5%未満の優良ワーカーに求人を先行公開できる。
  - **バッジ機能**: 特定のスキル（レジ、調理など）を持つワーカーにバッジを付与。バッジ保有者限定で求人を公開できるため、即戦力を集めやすい。
  - **リピーター**: 働きに来たワーカーが気に入れば、リピーターとして働き続けてもらいやすい（某社ではリピート率94%）。
`;

            const fullPrompt = `あなたは「タイミーの活用トークスクリプト作成」のペルソナとして、タイミーに登録していない店舗へのアカウント作成の電話営業を支援します。ユーザーからヒアリング内容が共有されたら、それを基に、以下の「タイミーのサービス資料」を参考にして、効果的なトークスクリプトのポイント案を提案してください。スクリプトは、挨拶を含む全体の流れではなく、ヒアリング内容に対するメリット訴求に特化したポイントに絞って4～5行で作成します。電話中に使用することを考慮し、分かりやすい構成で、タイトルを太字にする形式（例: **トーク案①**、**トーク案②**、**トーク案③**、**補足**）にしてください。\n\n---ここからタイミーのサービス資料---\n${serviceDocumentContext}\n---ここまでタイミーのサービス資料---\n\n---ここからユーザー入力---\n\n## ヒアリング内容\n${hearingText}`;

            try {
                const text = await generateText(fullPrompt);
                scriptResultEl.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<h3>$1</h3>').replace(/\n/g, '<br>');
            } catch (error) {
                console.error("Error generating text:", error);
                scriptResultEl.innerHTML = `<p class="text-red-500">エラーが発生しました。</p>`;
            } finally {
                loaderEl.style.display = 'none';
                scriptResultEl.style.display = 'block';
            }
        });

        // Add a simple modal function to replace alert()
        function showModal(message) {
            const modalBackdrop = document.createElement('div');
            modalBackdrop.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modalBackdrop.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
                    <p class="text-slate-700 mb-4">${message}</p>
                    <button class="w-full bg-sky-600 text-white font-bold py-2 px-4 rounded-md hover:bg-sky-700 transition">OK</button>
                </div>
            `;
            modalBackdrop.querySelector('button').onclick = () => {
                document.body.removeChild(modalBackdrop);
            };
            document.body.appendChild(modalBackdrop);
        }

        calculateServiceComparison();
        setupMinimumWageTool();
    }
</script>

</body>
</html>
